<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Nested dtypes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="nested_dtypes_files/libs/clipboard/clipboard.min.js"></script>
<script src="nested_dtypes_files/libs/quarto-html/quarto.js"></script>
<script src="nested_dtypes_files/libs/quarto-html/popper.min.js"></script>
<script src="nested_dtypes_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="nested_dtypes_files/libs/quarto-html/anchor.min.js"></script>
<link href="nested_dtypes_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="nested_dtypes_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="nested_dtypes_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="nested_dtypes_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="nested_dtypes_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Nested dtypes</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div id="setup-env" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %pip install -r requirements.txt</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="polars-version" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>pip show Polars <span class="co"># check you Polars version</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Name: polars
Version: 0.20.27
Summary: Blazingly fast DataFrame library
Home-page: 
Author: 
Author-email: Ritchie Vink &lt;ritchie46@gmail.com&gt;
License: 
Location: /Users/johnros/workspace/polars_demo/.venv/lib/python3.11/site-packages
Requires: 
Required-by: 
Note: you may need to restart the kernel to use updated packages.</code></pre>
</div>
</div>
<div id="pandas-version" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>pip show Pandas <span class="co"># check you Pandas version</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Name: pandas
Version: 2.2.2
Summary: Powerful data structures for data analysis, time series, and statistics
Home-page: https://pandas.pydata.org
Author: 
Author-email: The Pandas Development Team &lt;pandas-dev@python.org&gt;
License: BSD 3-Clause License

Copyright (c) 2008-2011, AQR Capital Management, LLC, Lambda Foundry, Inc. and PyData Development Team
All rights reserved.

Copyright (c) 2011-2023, Open source contributors.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are met:

* Redistributions of source code must retain the above copyright notice, this
  list of conditions and the following disclaimer.

* Redistributions in binary form must reproduce the above copyright notice,
  this list of conditions and the following disclaimer in the documentation
  and/or other materials provided with the distribution.

* Neither the name of the copyright holder nor the names of its
  contributors may be used to endorse or promote products derived from
  this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
Location: /Users/johnros/workspace/polars_demo/.venv/lib/python3.11/site-packages
Requires: numpy, python-dateutil, pytz, tzdata
Required-by: 
Note: you may need to restart the kernel to use updated packages.</code></pre>
</div>
</div>
<div id="preliminaries" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars <span class="im">as</span> pl</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>pl.Config(fmt_str_lengths<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars.selectors <span class="im">as</span> cs</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyarrow <span class="im">as</span> pa</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> string</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Following two lines only required to view plotly when rendering from VScode. </span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.io <span class="im">as</span> pio</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co"># pio.renderers.default = "plotly_mimetype+notebook_connected+notebook"</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>pio.renderers.default <span class="op">=</span> <span class="st">"plotly_mimetype+notebook"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What Polars module and dependencies are installed?</p>
<div id="show-versions" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>pl.show_versions()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>--------Version info---------
Polars:               0.20.27
Index type:           UInt32
Platform:             macOS-14.4.1-arm64-arm-64bit
Python:               3.11.6 (main, Oct  2 2023, 13:45:54) [Clang 15.0.0 (clang-1500.0.40.1)]

----Optional dependencies----
adbc_driver_manager:  &lt;not installed&gt;
cloudpickle:          &lt;not installed&gt;
connectorx:           &lt;not installed&gt;
deltalake:            &lt;not installed&gt;
fastexcel:            &lt;not installed&gt;
fsspec:               &lt;not installed&gt;
gevent:               &lt;not installed&gt;
hvplot:               &lt;not installed&gt;
matplotlib:           3.9.0
nest_asyncio:         1.6.0
numpy:                1.26.4
openpyxl:             &lt;not installed&gt;
pandas:               2.2.2
pyarrow:              16.1.0
pydantic:             &lt;not installed&gt;
pyiceberg:            &lt;not installed&gt;
pyxlsb:               &lt;not installed&gt;
sqlalchemy:           2.0.30
torch:                &lt;not installed&gt;
xlsx2csv:             &lt;not installed&gt;
xlsxwriter:           &lt;not installed&gt;</code></pre>
</div>
</div>
<p>How many cores are available for parallelism?</p>
<div id="cell-show-cores" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>pl.thread_pool_size()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="show-cores" class="cell-output cell-output-display" data-execution_count="7">
<pre><code>8</code></pre>
</div>
</div>
<section id="preliminaries" class="level1">
<h1>Preliminaries</h1>
<section id="a-polars-frame-can-hold-anything" class="level2">
<h2 class="anchored" data-anchor-id="a-polars-frame-can-hold-anything">A Polars Frame Can Hold Anything</h2>
<p>Fun fact- Polars, like Pandas, can store anything within a cell. For instance, a Polars frame can hold a Polars frame.</p>
<div id="make-polars-frame" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pl.DataFrame(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"a"</span>: [</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>            pl.DataFrame({<span class="st">"x"</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>], <span class="st">"y"</span>: [<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>]}), </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>            pl.DataFrame({<span class="st">"x"</span>: [<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>], <span class="st">"y"</span>: [<span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>]})</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>            ],</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"b"</span>: [<span class="st">"a"</span>, <span class="st">"b"</span>]</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (2, 2)
┌───────────────┬─────┐
│ a             ┆ b   │
│ ---           ┆ --- │
│ object        ┆ str │
╞═══════════════╪═════╡
│ shape: (3, 2) ┆ a   │
│ ┌─────┬─────┐ ┆     │
│ │ x   ┆ y   │ ┆     │
│ │ --- ┆ …     ┆     │
│ shape: (3, 2) ┆ b   │
│ ┌─────┬─────┐ ┆     │
│ │ x   ┆ y   │ ┆     │
│ │ --- ┆ …     ┆     │
└───────────────┴─────┘</code></pre>
</div>
</div>
<p>Things to note:</p>
<ul>
<li>The dtype of the frame is <code>Polars Object</code>.</li>
</ul>
</section>
<section id="motivation-for-nested-dtypes" class="level2">
<h2 class="anchored" data-anchor-id="motivation-for-nested-dtypes">Motivation For Nested dtypes</h2>
<p>Consider the following scenarios:</p>
<ol type="1">
<li><p>I want to compute with part-of-strings generated by a <strong>split</strong>.</p></li>
<li><p>I want to store and compute with arrays of <strong>varying lengths</strong>. Examples include: paths of cars on the globe, paths of users in a website,</p></li>
<li><p>I want to <strong>group columns</strong> together, and compute with them as a unit.</p>
<ol type="1">
<li>For convenience of access.</li>
<li>Because I am missing a <code>foo_horizontal()</code> method.</li>
</ol></li>
<li><p>I want to read a JSON/XML/YML with <strong>nested structures</strong>.</p></li>
</ol>
<p>How can I go about?</p>
<ol type="1">
<li>Since a Polars object, like a Python object, can hold anything, I could store the nested data as a <strong>Polars object</strong>.</li>
<li>I could generate <strong>many columns</strong>, and pad with nulls when lengths differ.</li>
<li>I could store each unit as a <strong>Polars Series</strong>.</li>
</ol>
<p>The <strong>Python object</strong> option is always available, and I will try to <strong>avoid it</strong>. If I can avoid Polars (i.e.&nbsp;Rust) calling Python, I will.</p>
<p>The second options could work. It is actually a good one, if I can figure out the <strong>column access</strong> (regex?).</p>
<p>The third option would be great. Unlike the first, I would remain within Rus. Unlike the second, I will have a <strong>named unit</strong> to access.</p>
<p>This is today’s topic.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>The Polars nested dtypes are inherited from the Arrow format. So these are actually “Arrow Nested dtypes with Polars’ functionality”.</p>
</div>
</div>
</section>
<section id="nested-dtypes-in-polars" class="level2">
<h2 class="anchored" data-anchor-id="nested-dtypes-in-polars">Nested dtypes in Polars</h2>
<p>The Polars nested dtypes, inherited from <a href="https://wesm.github.io/arrow-site-test/format/Layout.html">PyArrow</a>:</p>
<ol type="1">
<li><strong>Polars List</strong></li>
<li><strong>Polars Array</strong></li>
<li><strong>Polars Struct</strong></li>
</ol>
<p>A <strong>Polars list</strong> is a Polars Series within a cell: All elements in the cell must have the same dtype; the elements are unnamed so accessed by index or filter. Do not be confused by the name. A Polars list is not a Python list.</p>
<p>A <strong>Polars array</strong> is a Polars list with a fixed length: All elements in the cell must have the same dtype and the same length; the elements are unnamed so accessed by index or filter. Another mental model of a Polars array is a numpy 2D array within a Polars frame.</p>
<p>A <strong>Polars struct</strong> is a Polars DataFrame within a cell: All elements in the cell must have the same fields; the elements are named so accessed by field name. Do not think of the struct as a Python dict within a cell, because all rows must have the same fields.</p>
</section>
</section>
<section id="sec-list" class="level1">
<h1>Polars List</h1>
<section id="making-a-polars-list" class="level2">
<h2 class="anchored" data-anchor-id="making-a-polars-list">Making a Polars List</h2>
<p>Make a Polars list from a Python list.</p>
<div id="cell-make-list" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>pl.DataFrame(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"a"</span>: [[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>], [<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>], [<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>]],</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"b"</span>: [<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>]</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="make-list" class="cell-output cell-output-display" data-execution_count="9">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">b</th>
</tr>
<tr class="odd">
<th>list[i64]</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[1, 2, 3]</td>
<td>"a"</td>
</tr>
<tr class="even">
<td>[4, 5, 6]</td>
<td>"b"</td>
</tr>
<tr class="odd">
<td>[7, 8, 9]</td>
<td>"c"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Things to note:</p>
<ul>
<li><code>a</code> is not a Python list, rather, it is a Polars list.</li>
<li>Can a Polars list hold a Polars list? Yes. It can hold any Polars object, even nested ones (list of list of list, etc.); provided that all elements in the cell have the same dtype.</li>
</ul>
<p>Make a Polars list of Python lists of Python lists:</p>
<div id="cell-make-list-of-list" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>pl.DataFrame(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"a"</span>: [[[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>], [<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>], [<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>]], [[<span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>], [<span class="dv">13</span>, <span class="dv">14</span>, <span class="dv">15</span>], [<span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">18</span>]]],</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"b"</span>: [<span class="st">"a"</span>, <span class="st">"b"</span>]</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="make-list-of-list" class="cell-output cell-output-display" data-execution_count="10">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">b</th>
</tr>
<tr class="odd">
<th>list[list[i64]]</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[[1, 2, 3], [4, 5, 6], [7, 8, 9]]</td>
<td>"a"</td>
</tr>
<tr class="even">
<td>[[10, 11, 12], [13, 14, 15], [16, 17, 18]]</td>
<td>"b"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>More often you will not make a Polars list directly, but rather it will be the result of some operation:</p>
<ol type="1">
<li>When grouping without aggregation.</li>
<li>When splitting a string of unknown length (knonwn length will return a Polars struct, and I expect in the future a Polars array).</li>
<li>When wrapping a bunch of columns with <code>pl.concat_list()</code>.</li>
<li>When “imploding” (aka “collapsing”) a columns.</li>
</ol>
<section id="list-from-aggregation" class="level3">
<h3 class="anchored" data-anchor-id="list-from-aggregation">List from Aggregation</h3>
<p>A Polars group_by, will actually create a Polars list internally, before applying the <code>.agg()</code> method.</p>
<div id="cell-list-from-aggregation" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pl.DataFrame(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"a"</span>: [<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>],</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"b"</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>]</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>df.group_by(<span class="st">"a"</span>).agg(pl.col(<span class="st">"b"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-from-aggregation" class="cell-output cell-output-display" data-execution_count="11">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">b</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>list[i64]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
<td>[3, 4]</td>
</tr>
<tr class="even">
<td>3</td>
<td>[5, 6]</td>
</tr>
<tr class="odd">
<td>1</td>
<td>[1, 2]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="list-from-splitting-a-string" class="level3">
<h3 class="anchored" data-anchor-id="list-from-splitting-a-string">List From Splitting a String</h3>
<div id="cell-make-frame-with-string-to-split" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df_strings <span class="op">=</span> pl.DataFrame(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"a"</span>: [<span class="st">"apple, banana, orange"</span>, <span class="st">"apple, banana"</span>, <span class="st">"apple"</span>],</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>df_strings</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="make-frame-with-string-to-split" class="cell-output cell-output-display" data-execution_count="12">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"apple, banana, orange"</td>
</tr>
<tr class="even">
<td>"apple, banana"</td>
</tr>
<tr class="odd">
<td>"apple"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Now split <code>a</code> into… whatever Polars decides to return. Hint: a Polars list of Polars strings.</p>
<div id="e68b152e" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    df_strings</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'a'</span>).<span class="bu">str</span>.split(<span class="st">", "</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>list[str]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>["apple", "banana", "orange"]</td>
</tr>
<tr class="even">
<td>["apple", "banana"]</td>
</tr>
<tr class="odd">
<td>["apple"]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="list-from-imploding-a-column" class="level3">
<h3 class="anchored" data-anchor-id="list-from-imploding-a-column">List from Imploding a Column</h3>
<div id="cell-list-from-imploding" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df.with_columns(pl.col(<span class="st">"b"</span>).implode())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-from-imploding" class="cell-output cell-output-display" data-execution_count="14">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">b</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>list[i64]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>[1, 2, … 6]</td>
</tr>
<tr class="even">
<td>1</td>
<td>[1, 2, … 6]</td>
</tr>
<tr class="odd">
<td>2</td>
<td>[1, 2, … 6]</td>
</tr>
<tr class="even">
<td>2</td>
<td>[1, 2, … 6]</td>
</tr>
<tr class="odd">
<td>3</td>
<td>[1, 2, … 6]</td>
</tr>
<tr class="even">
<td>3</td>
<td>[1, 2, … 6]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Try replacing <code>.with_columns()</code> with <code>.select()</code> and see what happens.</p>
<p>Implode <code>group_by()</code>:</p>
<div id="cell-implode-within-group" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>df.group_by(<span class="st">"a"</span>).agg(pl.col(<span class="st">"b"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="implode-within-group" class="cell-output cell-output-display" data-execution_count="15">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">b</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>list[i64]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3</td>
<td>[5, 6]</td>
</tr>
<tr class="even">
<td>1</td>
<td>[1, 2]</td>
</tr>
<tr class="odd">
<td>2</td>
<td>[3, 4]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Implode <code>over()</code>:</p>
<div id="implode-over" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>df.with_columns(pl.col(<span class="st">"b"</span>).over(<span class="st">"a"</span>)) <span class="co"># no good</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>df.with_columns(pl.col(<span class="st">"b"</span>).implode().over(<span class="st">"a"</span>)) <span class="co"># no good</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>df.with_columns(pl.concat_list(<span class="st">'b'</span>).over(<span class="st">"a"</span>)) <span class="co"># no good</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="2363e776" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    df</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"b"</span>).over(<span class="st">"a"</span>, mapping_strategy<span class="op">=</span><span class="st">"join"</span>).alias(<span class="st">'over_join'</span>),</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"b"</span>).over(<span class="st">"a"</span>, mapping_strategy<span class="op">=</span><span class="st">"explode"</span>).alias(<span class="st">'over_explode'</span>),</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"b"</span>).over(<span class="st">"a"</span>, mapping_strategy<span class="op">=</span><span class="st">"group_to_rows"</span>).alias(<span class="st">'over_group_to_rows'</span>),</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co"># good!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 5)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">b</th>
<th data-quarto-table-cell-role="th">over_join</th>
<th data-quarto-table-cell-role="th">over_explode</th>
<th data-quarto-table-cell-role="th">over_group_to_rows</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>i64</th>
<th>list[i64]</th>
<th>i64</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1</td>
<td>[1, 2]</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td>1</td>
<td>2</td>
<td>[1, 2]</td>
<td>2</td>
<td>2</td>
</tr>
<tr class="odd">
<td>2</td>
<td>3</td>
<td>[3, 4]</td>
<td>3</td>
<td>3</td>
</tr>
<tr class="even">
<td>2</td>
<td>4</td>
<td>[3, 4]</td>
<td>4</td>
<td>4</td>
</tr>
<tr class="odd">
<td>3</td>
<td>5</td>
<td>[5, 6]</td>
<td>5</td>
<td>5</td>
</tr>
<tr class="even">
<td>3</td>
<td>6</td>
<td>[5, 6]</td>
<td>6</td>
<td>6</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Things to note:</p>
<ul>
<li>The <code>mapping_strategy</code> argument govern the way the result within group is propagate to each row. Trying chainging its value to see the effect.</li>
<li>See <a href="https://github.com/pola-rs/polars/pull/6487">here</a> for more context on how <code>.over()</code> works and why.</li>
</ul>
</section>
<section id="list-from-pl.concat_list" class="level3">
<h3 class="anchored" data-anchor-id="list-from-pl.concat_list">List From <code>pl.concat_list()</code></h3>
<div id="cell-list-from-concatenation" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>df.select(pl.concat_list([pl.col(<span class="st">"a"</span>), pl.col(<span class="st">"b"</span>)]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-from-concatenation" class="cell-output cell-output-display" data-execution_count="17">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>list[i64]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[1, 1]</td>
</tr>
<tr class="even">
<td>[1, 2]</td>
</tr>
<tr class="odd">
<td>[2, 3]</td>
</tr>
<tr class="even">
<td>[2, 4]</td>
</tr>
<tr class="odd">
<td>[3, 5]</td>
</tr>
<tr class="even">
<td>[3, 6]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="list-from-.list.concat" class="level3">
<h3 class="anchored" data-anchor-id="list-from-.list.concat">List From <code>.list.concat()</code></h3>
<div id="3ad39f84" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    df</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>        pl.concat_list([pl.col(<span class="st">"a"</span>), pl.col(<span class="st">"b"</span>)]).alias(<span class="st">'ab'</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    .select(pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.concat([<span class="st">'a'</span>,<span class="st">'a'</span>,<span class="st">'a'</span>]))</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    .to_pandas()</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ab</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>[1, 1, 1, 1, 1]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>[1, 2, 1, 1, 1]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>[2, 3, 2, 2, 2]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>[2, 4, 2, 2, 2]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>[3, 5, 3, 3, 3]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>[3, 6, 3, 3, 3]</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</section>
</section>
<section id="operating-on-list-elements" class="level2">
<h2 class="anchored" data-anchor-id="operating-on-list-elements">Operating on List Elements</h2>
<p>Arguably, the only motivation for using a Polars list, is for easy access to the list and its elements. You are thus welcome to think of equivalent operations, without the <code>.list.</code> API.</p>
<p>An element can be accessed and trasformed with <code>list.eval(pl.element())</code>, which will expose (almost) all the methods of a <code>pl.Expr()</code> object.</p>
<div id="cell-list-eval-element" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>df_with_list <span class="op">=</span> (</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    df</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>        pl.concat_list([<span class="st">'a'</span>,<span class="st">'b'</span>]).alias(<span class="st">'ab'</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    df_with_list</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.<span class="bu">eval</span>(</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>            pl.element().add(<span class="dv">1000</span>)</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-eval-element" class="cell-output cell-output-display" data-execution_count="19">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ab</th>
</tr>
<tr class="odd">
<th>list[i64]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[1001, 1001]</td>
</tr>
<tr class="even">
<td>[1001, 1002]</td>
</tr>
<tr class="odd">
<td>[1002, 1003]</td>
</tr>
<tr class="even">
<td>[1002, 1004]</td>
</tr>
<tr class="odd">
<td>[1003, 1005]</td>
</tr>
<tr class="even">
<td>[1003, 1006]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Things to note:</p>
<ul>
<li><code>.eval()</code> belongs to the <code>.list</code> namespace.</li>
<li><code>pl.element()</code> is a selector that selects the elements of the list. It has almost all the methods available to <code>pl.col()</code>.</li>
<li><code>.eval()</code> currently cannot access other columns. You will probably discover this is a considerable limitation.</li>
</ul>
<div id="list-eval-element-methods" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">dir</span>(pl.element()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['__abs__', '__add__', '__and__', '__annotations__', '__array_ufunc__', '__bool__', '__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__floordiv__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__invert__', '__le__', '__lt__', '__mod__', '__module__', '__mul__', '__ne__', '__neg__', '__new__', '__or__', '__pos__', '__pow__', '__radd__', '__rand__', '__reduce__', '__reduce_ex__', '__repr__', '__rfloordiv__', '__rmod__', '__rmul__', '__ror__', '__rpow__', '__rsub__', '__rtruediv__', '__rxor__', '__setattr__', '__setstate__', '__sizeof__', '__str__', '__sub__', '__subclasshook__', '__truediv__', '__weakref__', '__xor__', '_accessors', '_from_pyexpr', '_map_batches_wrapper', '_pyexpr', '_register_plugin', '_repr_html_', 'abs', 'add', 'agg_groups', 'alias', 'all', 'and_', 'any', 'append', 'apply', 'approx_n_unique', 'arccos', 'arccosh', 'arcsin', 'arcsinh', 'arctan', 'arctanh', 'arg_max', 'arg_min', 'arg_sort', 'arg_true', 'arg_unique', 'arr', 'backward_fill', 'bin', 'bottom_k', 'bottom_k_by', 'cast', 'cat', 'cbrt', 'ceil', 'clip', 'clip_max', 'clip_min', 'cos', 'cosh', 'cot', 'count', 'cum_count', 'cum_max', 'cum_min', 'cum_prod', 'cum_sum', 'cumcount', 'cummax', 'cummin', 'cumprod', 'cumsum', 'cumulative_eval', 'cut', 'degrees', 'deserialize', 'diff', 'dot', 'drop_nans', 'drop_nulls', 'dt', 'entropy', 'eq', 'eq_missing', 'ewm_mean', 'ewm_mean_by', 'ewm_std', 'ewm_var', 'exclude', 'exp', 'explode', 'extend_constant', 'fill_nan', 'fill_null', 'filter', 'first', 'flatten', 'floor', 'floordiv', 'forward_fill', 'from_json', 'gather', 'gather_every', 'ge', 'get', 'gt', 'hash', 'head', 'hist', 'implode', 'inspect', 'interpolate', 'is_between', 'is_duplicated', 'is_finite', 'is_first', 'is_first_distinct', 'is_in', 'is_infinite', 'is_last', 'is_last_distinct', 'is_nan', 'is_not', 'is_not_nan', 'is_not_null', 'is_null', 'is_unique', 'keep_name', 'kurtosis', 'last', 'le', 'len', 'limit', 'list', 'log', 'log10', 'log1p', 'lower_bound', 'lt', 'map', 'map_alias', 'map_batches', 'map_dict', 'map_elements', 'max', 'mean', 'median', 'meta', 'min', 'mod', 'mode', 'mul', 'n_unique', 'name', 'nan_max', 'nan_min', 'ne', 'ne_missing', 'neg', 'not_', 'null_count', 'or_', 'over', 'pct_change', 'peak_max', 'peak_min', 'pipe', 'pow', 'prefix', 'product', 'qcut', 'quantile', 'radians', 'rank', 'rechunk', 'register_plugin', 'reinterpret', 'repeat_by', 'replace', 'reshape', 'reverse', 'rle', 'rle_id', 'rolling', 'rolling_apply', 'rolling_map', 'rolling_max', 'rolling_max_by', 'rolling_mean', 'rolling_mean_by', 'rolling_median', 'rolling_median_by', 'rolling_min', 'rolling_min_by', 'rolling_quantile', 'rolling_quantile_by', 'rolling_skew', 'rolling_std', 'rolling_std_by', 'rolling_sum', 'rolling_sum_by', 'rolling_var', 'rolling_var_by', 'round', 'round_sig_figs', 'sample', 'search_sorted', 'set_sorted', 'shift', 'shift_and_fill', 'shrink_dtype', 'shuffle', 'sign', 'sin', 'sinh', 'skew', 'slice', 'sort', 'sort_by', 'sqrt', 'std', 'str', 'struct', 'sub', 'suffix', 'sum', 'tail', 'take', 'take_every', 'tan', 'tanh', 'to_physical', 'top_k', 'top_k_by', 'truediv', 'unique', 'unique_counts', 'upper_bound', 'value_counts', 'var', 'where', 'xor']</code></pre>
</div>
</div>
<p><code>list.eval(pl.element())</code>, however, does not see to add much that cannot be done with <code>pl.col()</code> methods. The true power of the <code>.list</code> namespace, is in is pre-defined methods.</p>
</section>
<section id="list-methods" class="level2">
<h2 class="anchored" data-anchor-id="list-methods">List Methods</h2>
<section id="accessing-elements" class="level3">
<h3 class="anchored" data-anchor-id="accessing-elements">Accessing Elements</h3>
<p>Recall; list elements are unnamed. They are thus accessed using indices (<code>iloc[]</code> style).</p>
<div id="cell-list-get-and-gather" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    df_with_list.select(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>),</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.get(<span class="dv">0</span>).alias(<span class="st">'get_1'</span>), </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.gather([<span class="dv">0</span>]).alias(<span class="st">'gather_1'</span>), <span class="co"># returns a list</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.<span class="bu">slice</span>(<span class="dv">0</span>,<span class="dv">1</span>).alias(<span class="st">'slice_1'</span>), <span class="co"># returns a list</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.gather([<span class="dv">0</span>, <span class="dv">1</span>]).alias(<span class="st">'gather_2'</span>),</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.<span class="bu">slice</span>(<span class="dv">0</span>,<span class="dv">2</span>).alias(<span class="st">'slice_2'</span>),</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.gather_every(<span class="dv">2</span>).alias(<span class="st">'gather_every_2'</span>),</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-get-and-gather" class="cell-output cell-output-display" data-execution_count="21">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 7)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ab</th>
<th data-quarto-table-cell-role="th">get_1</th>
<th data-quarto-table-cell-role="th">gather_1</th>
<th data-quarto-table-cell-role="th">slice_1</th>
<th data-quarto-table-cell-role="th">gather_2</th>
<th data-quarto-table-cell-role="th">slice_2</th>
<th data-quarto-table-cell-role="th">gather_every_2</th>
</tr>
<tr class="odd">
<th>list[i64]</th>
<th>i64</th>
<th>list[i64]</th>
<th>list[i64]</th>
<th>list[i64]</th>
<th>list[i64]</th>
<th>list[i64]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[1, 1]</td>
<td>1</td>
<td>[1]</td>
<td>[1]</td>
<td>[1, 1]</td>
<td>[1, 1]</td>
<td>[1]</td>
</tr>
<tr class="even">
<td>[1, 2]</td>
<td>1</td>
<td>[1]</td>
<td>[1]</td>
<td>[1, 2]</td>
<td>[1, 2]</td>
<td>[1]</td>
</tr>
<tr class="odd">
<td>[2, 3]</td>
<td>2</td>
<td>[2]</td>
<td>[2]</td>
<td>[2, 3]</td>
<td>[2, 3]</td>
<td>[2]</td>
</tr>
<tr class="even">
<td>[2, 4]</td>
<td>2</td>
<td>[2]</td>
<td>[2]</td>
<td>[2, 4]</td>
<td>[2, 4]</td>
<td>[2]</td>
</tr>
<tr class="odd">
<td>[3, 5]</td>
<td>3</td>
<td>[3]</td>
<td>[3]</td>
<td>[3, 5]</td>
<td>[3, 5]</td>
<td>[3]</td>
</tr>
<tr class="even">
<td>[3, 6]</td>
<td>3</td>
<td>[3]</td>
<td>[3]</td>
<td>[3, 6]</td>
<td>[3, 6]</td>
<td>[3]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Things to note:</p>
<ul>
<li>What returns a list, and what returns a single element?</li>
</ul>
<p>First, Head, Last, Tail</p>
<div id="cell-list-methods" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    df_with_list.select(</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>),</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.get(<span class="dv">1</span>).alias(<span class="st">'first_1'</span>),</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.first().alias(<span class="st">'first_2'</span>),</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.head(<span class="dv">1</span>).alias(<span class="st">'first_5'</span>), <span class="co"># returns a list</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.last().alias(<span class="st">'last_2'</span>), </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.tail(<span class="dv">1</span>).alias(<span class="st">'last_1'</span>), <span class="co"># returns a list</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.tail(<span class="dv">1</span>).<span class="bu">list</span>.first().alias(<span class="st">'last_3'</span>),</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-methods" class="cell-output cell-output-display" data-execution_count="22">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 7)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ab</th>
<th data-quarto-table-cell-role="th">first_1</th>
<th data-quarto-table-cell-role="th">first_2</th>
<th data-quarto-table-cell-role="th">first_5</th>
<th data-quarto-table-cell-role="th">last_2</th>
<th data-quarto-table-cell-role="th">last_1</th>
<th data-quarto-table-cell-role="th">last_3</th>
</tr>
<tr class="odd">
<th>list[i64]</th>
<th>i64</th>
<th>i64</th>
<th>list[i64]</th>
<th>i64</th>
<th>list[i64]</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[1, 1]</td>
<td>1</td>
<td>1</td>
<td>[1]</td>
<td>1</td>
<td>[1]</td>
<td>1</td>
</tr>
<tr class="even">
<td>[1, 2]</td>
<td>2</td>
<td>1</td>
<td>[1]</td>
<td>2</td>
<td>[2]</td>
<td>2</td>
</tr>
<tr class="odd">
<td>[2, 3]</td>
<td>3</td>
<td>2</td>
<td>[2]</td>
<td>3</td>
<td>[3]</td>
<td>3</td>
</tr>
<tr class="even">
<td>[2, 4]</td>
<td>4</td>
<td>2</td>
<td>[2]</td>
<td>4</td>
<td>[4]</td>
<td>4</td>
</tr>
<tr class="odd">
<td>[3, 5]</td>
<td>5</td>
<td>3</td>
<td>[3]</td>
<td>5</td>
<td>[5]</td>
<td>5</td>
</tr>
<tr class="even">
<td>[3, 6]</td>
<td>6</td>
<td>3</td>
<td>[3]</td>
<td>6</td>
<td>[6]</td>
<td>6</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Shift</p>
<div id="cell-list-shift" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    df_with_list.select(</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>),</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.shift(<span class="dv">1</span>).alias(<span class="st">'shift_1'</span>),</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.shift(<span class="op">-</span><span class="dv">1</span>).alias(<span class="st">'shift_-1'</span>),</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-shift" class="cell-output cell-output-display" data-execution_count="23">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 3)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ab</th>
<th data-quarto-table-cell-role="th">shift_1</th>
<th data-quarto-table-cell-role="th">shift_-1</th>
</tr>
<tr class="odd">
<th>list[i64]</th>
<th>list[i64]</th>
<th>list[i64]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[1, 1]</td>
<td>[null, 1]</td>
<td>[1, null]</td>
</tr>
<tr class="even">
<td>[1, 2]</td>
<td>[null, 1]</td>
<td>[2, null]</td>
</tr>
<tr class="odd">
<td>[2, 3]</td>
<td>[null, 2]</td>
<td>[3, null]</td>
</tr>
<tr class="even">
<td>[2, 4]</td>
<td>[null, 2]</td>
<td>[4, null]</td>
</tr>
<tr class="odd">
<td>[3, 5]</td>
<td>[null, 3]</td>
<td>[5, null]</td>
</tr>
<tr class="even">
<td>[3, 6]</td>
<td>[null, 3]</td>
<td>[6, null]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Sample</p>
<div id="cell-list-sample" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    df_with_list.select(</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>),</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.sample(<span class="dv">10</span>, with_replacement<span class="op">=</span><span class="va">True</span>).alias(<span class="st">'sample'</span>),</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    .to_pandas()</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-sample" class="cell-output cell-output-display" data-execution_count="24">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ab</th>
<th data-quarto-table-cell-role="th">sample</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>[1, 1]</td>
<td>[1, 1, 1, 1, 1, 1, 1, 1, 1, 1]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>[1, 2]</td>
<td>[1, 1, 1, 1, 2, 1, 1, 1, 2, 1]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>[2, 3]</td>
<td>[2, 2, 3, 3, 2, 3, 2, 2, 2, 2]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>[2, 4]</td>
<td>[4, 4, 2, 2, 2, 4, 2, 2, 4, 4]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>[3, 5]</td>
<td>[5, 3, 5, 5, 3, 3, 5, 3, 3, 5]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>[3, 6]</td>
<td>[6, 3, 3, 3, 3, 3, 6, 3, 3, 3]</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>Careful where you put the <code>.sample()</code>!</p>
<div id="3ad2d5ea" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    df_with_list</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>),</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.sample(<span class="dv">10</span>, with_replacement<span class="op">=</span><span class="va">True</span>).alias(<span class="st">'within_row'</span>),</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).sample(<span class="dv">6</span>, with_replacement<span class="op">=</span><span class="va">True</span>).alias(<span class="st">'within_column'</span>),</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    .to_pandas()</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ab</th>
<th data-quarto-table-cell-role="th">within_row</th>
<th data-quarto-table-cell-role="th">within_column</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>[1, 1]</td>
<td>[1, 1, 1, 1, 1, 1, 1, 1, 1, 1]</td>
<td>[3, 6]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>[1, 2]</td>
<td>[2, 1, 1, 2, 1, 2, 1, 1, 2, 2]</td>
<td>[1, 2]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>[2, 3]</td>
<td>[3, 2, 2, 2, 3, 2, 3, 3, 2, 2]</td>
<td>[3, 6]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>[2, 4]</td>
<td>[4, 2, 2, 4, 2, 2, 4, 2, 2, 2]</td>
<td>[2, 4]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>[3, 5]</td>
<td>[3, 5, 5, 3, 5, 5, 5, 3, 3, 5]</td>
<td>[3, 6]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>[3, 6]</td>
<td>[3, 3, 6, 6, 3, 3, 3, 3, 3, 3]</td>
<td>[1, 2]</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</section>
<section id="statistical-aggregations" class="level3">
<h3 class="anchored" data-anchor-id="statistical-aggregations">Statistical Aggregations</h3>
<div id="cell-list-statistical-aggregations" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    df_with_list</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>),</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.<span class="bu">min</span>().alias(<span class="st">'min'</span>),</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.<span class="bu">max</span>().alias(<span class="st">'max'</span>),</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.<span class="bu">sum</span>().alias(<span class="st">'sum'</span>),</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.mean().alias(<span class="st">'mean'</span>),</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.median().alias(<span class="st">'median'</span>),</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.var().alias(<span class="st">'var'</span>),</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.std().alias(<span class="st">'std'</span>),</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.n_unique().alias(<span class="st">'n_unique'</span>),</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.unique().alias(<span class="st">'unique'</span>),</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.<span class="bu">len</span>().alias(<span class="st">'len'</span>),</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-statistical-aggregations" class="cell-output cell-output-display" data-execution_count="26">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 11)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ab</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">max</th>
<th data-quarto-table-cell-role="th">sum</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">median</th>
<th data-quarto-table-cell-role="th">var</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">n_unique</th>
<th data-quarto-table-cell-role="th">unique</th>
<th data-quarto-table-cell-role="th">len</th>
</tr>
<tr class="odd">
<th>list[i64]</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>u32</th>
<th>list[i64]</th>
<th>u32</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[1, 1]</td>
<td>1</td>
<td>1</td>
<td>2</td>
<td>1.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1</td>
<td>[1]</td>
<td>2</td>
</tr>
<tr class="even">
<td>[1, 2]</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>1.5</td>
<td>1.5</td>
<td>0.5</td>
<td>0.707107</td>
<td>2</td>
<td>[1, 2]</td>
<td>2</td>
</tr>
<tr class="odd">
<td>[2, 3]</td>
<td>2</td>
<td>3</td>
<td>5</td>
<td>2.5</td>
<td>2.5</td>
<td>0.5</td>
<td>0.707107</td>
<td>2</td>
<td>[2, 3]</td>
<td>2</td>
</tr>
<tr class="even">
<td>[2, 4]</td>
<td>2</td>
<td>4</td>
<td>6</td>
<td>3.0</td>
<td>3.0</td>
<td>2.0</td>
<td>1.414214</td>
<td>2</td>
<td>[2, 4]</td>
<td>2</td>
</tr>
<tr class="odd">
<td>[3, 5]</td>
<td>3</td>
<td>5</td>
<td>8</td>
<td>4.0</td>
<td>4.0</td>
<td>2.0</td>
<td>1.414214</td>
<td>2</td>
<td>[3, 5]</td>
<td>2</td>
</tr>
<tr class="even">
<td>[3, 6]</td>
<td>3</td>
<td>6</td>
<td>9</td>
<td>4.5</td>
<td>4.5</td>
<td>4.5</td>
<td>2.12132</td>
<td>2</td>
<td>[3, 6]</td>
<td>2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="ordering-and-ranking" class="level3">
<h3 class="anchored" data-anchor-id="ordering-and-ranking">Ordering and Ranking</h3>
<div id="cell-list-ordering-and-ranking" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    df_with_list</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>),</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>        <span class="co"># pl.col('ab').list.rank().alias('rank'),</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.sort().alias(<span class="st">'sort'</span>),</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.reverse().alias(<span class="st">'reverse'</span>),</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-ordering-and-ranking" class="cell-output cell-output-display" data-execution_count="27">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 3)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ab</th>
<th data-quarto-table-cell-role="th">sort</th>
<th data-quarto-table-cell-role="th">reverse</th>
</tr>
<tr class="odd">
<th>list[i64]</th>
<th>list[i64]</th>
<th>list[i64]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[1, 1]</td>
<td>[1, 1]</td>
<td>[1, 1]</td>
</tr>
<tr class="even">
<td>[1, 2]</td>
<td>[1, 2]</td>
<td>[2, 1]</td>
</tr>
<tr class="odd">
<td>[2, 3]</td>
<td>[2, 3]</td>
<td>[3, 2]</td>
</tr>
<tr class="even">
<td>[2, 4]</td>
<td>[2, 4]</td>
<td>[4, 2]</td>
</tr>
<tr class="odd">
<td>[3, 5]</td>
<td>[3, 5]</td>
<td>[5, 3]</td>
</tr>
<tr class="even">
<td>[3, 6]</td>
<td>[3, 6]</td>
<td>[6, 3]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="sequence-operations" class="level3">
<h3 class="anchored" data-anchor-id="sequence-operations">Sequence Operations</h3>
<div id="cell-list-diff" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    df_with_list</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>),</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.diff().alias(<span class="st">'diff'</span>),</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-diff" class="cell-output cell-output-display" data-execution_count="28">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ab</th>
<th data-quarto-table-cell-role="th">diff</th>
</tr>
<tr class="odd">
<th>list[i64]</th>
<th>list[i64]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[1, 1]</td>
<td>[null, 0]</td>
</tr>
<tr class="even">
<td>[1, 2]</td>
<td>[null, 1]</td>
</tr>
<tr class="odd">
<td>[2, 3]</td>
<td>[null, 1]</td>
</tr>
<tr class="even">
<td>[2, 4]</td>
<td>[null, 2]</td>
</tr>
<tr class="odd">
<td>[3, 5]</td>
<td>[null, 2]</td>
</tr>
<tr class="even">
<td>[3, 6]</td>
<td>[null, 3]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>What about <code>.pct_change()</code>? The following will not work, but see <a href="#sec-pct-change" class="quarto-xref">Section&nbsp;2.5.0.1</a> for a workaround.</p>
<div id="3b34eddf" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#eval: false</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    df_with_list</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.pct_change().alias(<span class="st">'pct_change'</span>),</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>AttributeError: 'ExprListNameSpace' object has no attribute 'pct_change'</code></pre>
</div>
</div>
</section>
<section id="logical-aggregations" class="level3">
<h3 class="anchored" data-anchor-id="logical-aggregations">Logical Aggregations</h3>
<div id="cell-list-logical-aggregations" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    df_with_list</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>),</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.<span class="bu">eval</span>(pl.element().eq(<span class="dv">1</span>)).<span class="bu">list</span>.<span class="bu">any</span>().alias(<span class="st">'any'</span>),</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.<span class="bu">eval</span>(pl.element().eq(<span class="dv">1</span>)).<span class="bu">list</span>.<span class="bu">all</span>().alias(<span class="st">'all'</span>),</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-logical-aggregations" class="cell-output cell-output-display" data-execution_count="30">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 3)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ab</th>
<th data-quarto-table-cell-role="th">any</th>
<th data-quarto-table-cell-role="th">all</th>
</tr>
<tr class="odd">
<th>list[i64]</th>
<th>bool</th>
<th>bool</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[1, 1]</td>
<td>true</td>
<td>true</td>
</tr>
<tr class="even">
<td>[1, 2]</td>
<td>true</td>
<td>false</td>
</tr>
<tr class="odd">
<td>[2, 3]</td>
<td>false</td>
<td>false</td>
</tr>
<tr class="even">
<td>[2, 4]</td>
<td>false</td>
<td>false</td>
</tr>
<tr class="odd">
<td>[3, 5]</td>
<td>false</td>
<td>false</td>
</tr>
<tr class="even">
<td>[3, 6]</td>
<td>false</td>
<td>false</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="string-operations" class="level3">
<h3 class="anchored" data-anchor-id="string-operations">String Operations</h3>
<ul>
<li><code>list.join()</code> will join the strings in the list. I admit, I would have expected a <code>.list.str.concat()</code> instead.</li>
<li><code>list.contains()</code> will check if the list contains a string.</li>
<li><code>list.count_matches()</code> will count the number of times a string appears in the list.</li>
</ul>
<div id="cell-list-strings" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>df_2_with_list <span class="op">=</span> pl.DataFrame(</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ab"</span>: [[<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>], [<span class="st">"d"</span>, <span class="st">"e"</span>, <span class="st">"f"</span>], [<span class="st">"g"</span>, <span class="st">"h"</span>, <span class="st">"i"</span>]],</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">'sep'</span>: [<span class="st">'@'</span>, <span class="st">'#'</span>, <span class="st">'$'</span>]</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    df_2_with_list</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>),</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'sep'</span>),</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.join(pl.col(<span class="st">'sep'</span>)).alias(<span class="st">'joined'</span>),</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.contains(<span class="st">'a'</span>).alias(<span class="st">'contains_a'</span>),</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.count_matches(<span class="st">'a'</span>).alias(<span class="st">'count_a'</span>),</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-strings" class="cell-output cell-output-display" data-execution_count="31">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 5)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ab</th>
<th data-quarto-table-cell-role="th">sep</th>
<th data-quarto-table-cell-role="th">joined</th>
<th data-quarto-table-cell-role="th">contains_a</th>
<th data-quarto-table-cell-role="th">count_a</th>
</tr>
<tr class="odd">
<th>list[str]</th>
<th>str</th>
<th>str</th>
<th>bool</th>
<th>u32</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>["a", "b", "c"]</td>
<td>"@"</td>
<td>"a@b@c"</td>
<td>true</td>
<td>1</td>
</tr>
<tr class="even">
<td>["d", "e", "f"]</td>
<td>"#"</td>
<td>"d#e#f"</td>
<td>false</td>
<td>0</td>
</tr>
<tr class="odd">
<td>["g", "h", "i"]</td>
<td>"$"</td>
<td>"g$h$i"</td>
<td>false</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="filtering" class="level3">
<h3 class="anchored" data-anchor-id="filtering">Filtering</h3>
<p>Currently there is no <code>.list.filter()</code> method (see <a href="https://github.com/pola-rs/polars/issues/9189">issue</a>). There are, however, many workarounds.</p>
<section id="option-1-using-pl.element.filter" class="level4">
<h4 class="anchored" data-anchor-id="option-1-using-pl.element.filter">Option 1: Using <code>pl.element().filter()</code></h4>
<div id="cell-list-filter" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    df_with_list</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>),</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.<span class="bu">eval</span>(</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>            pl.element()</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>            .<span class="bu">filter</span>(pl.element().gt(<span class="dv">2</span>)),</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>        .alias(<span class="st">'gt_2'</span>),</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-filter" class="cell-output cell-output-display" data-execution_count="32">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ab</th>
<th data-quarto-table-cell-role="th">gt_2</th>
</tr>
<tr class="odd">
<th>list[i64]</th>
<th>list[i64]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[1, 1]</td>
<td>[]</td>
</tr>
<tr class="even">
<td>[1, 2]</td>
<td>[]</td>
</tr>
<tr class="odd">
<td>[2, 3]</td>
<td>[3]</td>
</tr>
<tr class="even">
<td>[2, 4]</td>
<td>[4]</td>
</tr>
<tr class="odd">
<td>[3, 5]</td>
<td>[3, 5]</td>
</tr>
<tr class="even">
<td>[3, 6]</td>
<td>[3, 6]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="option-2-using-.list.gather-pl.arg_where" class="level4">
<h4 class="anchored" data-anchor-id="option-2-using-.list.gather-pl.arg_where">Option 2: Using <code>.list.gather()</code> + <code>pl.arg_where()</code></h4>
<p>Let’s try to filter elements of a list based on the length of the string.</p>
<div id="d8e8df81" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample data</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pl.DataFrame({</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'string_list'</span>: [</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>        [<span class="st">"apple"</span>, <span class="st">"banana"</span>, <span class="st">"orange"</span>, <span class="st">"grape"</span>, <span class="st">"pear"</span>],</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>        [<span class="st">"apple"</span>, <span class="st">"banana"</span>, <span class="st">"orange"</span>, <span class="st">"grape"</span>],</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>        [<span class="st">"apple"</span>, <span class="st">"banana"</span>, <span class="st">"orange"</span>],</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>        [<span class="st">"apple"</span>, <span class="st">"banana"</span>],</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>        [<span class="st">"apple"</span>],</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>        [<span class="st">"apple"</span>, <span class="st">"banana"</span>, <span class="st">"orange"</span>, <span class="st">"grape"</span>, <span class="st">"pear"</span>],</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>        [<span class="st">"apple"</span>, <span class="st">"banana"</span>, <span class="st">"orange"</span>, <span class="st">"grape"</span>],</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In each list, keep only strings of length 4.</p>
<p>Using <code>.list.gather()</code> and <code>pl.arg_where()</code> and explode to access <code>pl.col().str</code> methods.</p>
<div id="84dc19ee" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    data</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    .with_row_index(<span class="st">'i'</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'string_list'</span>).<span class="bu">list</span>.gather(</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>            pl.arg_where(</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>                pl.col(<span class="st">'string_list'</span>).explode().<span class="bu">str</span>.len_chars().eq(<span class="dv">4</span>))</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>                .over(<span class="st">'i'</span>)</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    .drop(<span class="st">'i'</span>)</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (7, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">string_list</th>
</tr>
<tr class="odd">
<th>list[str]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>["pear"]</td>
</tr>
<tr class="even">
<td>[]</td>
</tr>
<tr class="odd">
<td>[]</td>
</tr>
<tr class="even">
<td>[]</td>
</tr>
<tr class="odd">
<td>[]</td>
</tr>
<tr class="even">
<td>["pear"]</td>
</tr>
<tr class="odd">
<td>[]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Without exploding: Using <code>list.gather()</code> to filter, and <code>list.eval()</code> to access <code>pl.element().str</code> methods.</p>
<div id="e041298c" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    data</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'string_list'</span>).<span class="bu">list</span>.gather(</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>            pl.col(<span class="st">'string_list'</span>).<span class="bu">list</span>.<span class="bu">eval</span>(</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>                pl.arg_where(</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>                    pl.element().<span class="bu">str</span>.len_chars().eq(<span class="dv">4</span>)</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (7, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">string_list</th>
</tr>
<tr class="odd">
<th>list[str]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>["pear"]</td>
</tr>
<tr class="even">
<td>[]</td>
</tr>
<tr class="odd">
<td>[]</td>
</tr>
<tr class="even">
<td>[]</td>
</tr>
<tr class="odd">
<td>[]</td>
</tr>
<tr class="even">
<td>["pear"]</td>
</tr>
<tr class="odd">
<td>[]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Explode once, and call the output twice using the Walrus operator; once to access <code>pl.col().filter()</code> and then to access <code>pl.col().str</code>.</p>
<div id="7dc76e71" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    data</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    .with_row_index(<span class="st">'i'</span>)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>        (</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>            (cntr <span class="op">:=</span> pl.col(<span class="st">'string_list'</span>).explode())</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>            .<span class="bu">filter</span>(cntr.<span class="bu">str</span>.len_chars().eq(<span class="dv">4</span>))</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>        .implode()</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>        .over(<span class="st">'i'</span>)</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>    .drop(<span class="st">'i'</span>)</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (7, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">string_list</th>
</tr>
<tr class="odd">
<th>list[str]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>["pear"]</td>
</tr>
<tr class="even">
<td>[]</td>
</tr>
<tr class="odd">
<td>[]</td>
</tr>
<tr class="even">
<td>[]</td>
</tr>
<tr class="odd">
<td>[]</td>
</tr>
<tr class="even">
<td>["pear"]</td>
</tr>
<tr class="odd">
<td>[]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Things to note:</p>
<ul>
<li>If you are unfamilar with Python’s (not Polars’) Walrus operator <code>:=</code>, see <a href="https://realpython.com/python-walrus-operator/">here</a>.</li>
</ul>
</section>
</section>
<section id="missing" class="level3">
<h3 class="anchored" data-anchor-id="missing">Missing</h3>
<p>I believe everything can be done with <code>.list.eval(pl.element().method())</code>.</p>
</section>
<section id="set-operations" class="level3">
<h3 class="anchored" data-anchor-id="set-operations">Set Operations</h3>
<p>.list.set_intersection</p>
<p>.list.set_union</p>
<p>.list.set_difference</p>
<p>.list.set_symmetric_difference</p>
<div id="dc4ac92d" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    df_with_list</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>),</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.set_intersection([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]).alias(<span class="st">'intersection'</span>),</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.set_union([<span class="st">'11'</span>]).alias(<span class="st">'union'</span>),</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.set_union([<span class="st">'a'</span>]).alias(<span class="st">'union_2'</span>),</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.set_difference([<span class="dv">2</span>,<span class="dv">3</span>]).alias(<span class="st">'difference'</span>),</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.set_symmetric_difference([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]).alias(<span class="st">'symmetric_difference'</span>),</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 6)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ab</th>
<th data-quarto-table-cell-role="th">intersection</th>
<th data-quarto-table-cell-role="th">union</th>
<th data-quarto-table-cell-role="th">union_2</th>
<th data-quarto-table-cell-role="th">difference</th>
<th data-quarto-table-cell-role="th">symmetric_difference</th>
</tr>
<tr class="odd">
<th>list[i64]</th>
<th>list[i64]</th>
<th>list[i64]</th>
<th>list[i64]</th>
<th>list[i64]</th>
<th>list[i64]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[1, 1]</td>
<td>[1]</td>
<td>[1, 11]</td>
<td>[1, null]</td>
<td>[1]</td>
<td>[2, 3]</td>
</tr>
<tr class="even">
<td>[1, 2]</td>
<td>[1, 2]</td>
<td>[1, 2, 11]</td>
<td>[1, 2, null]</td>
<td>[1]</td>
<td>[3]</td>
</tr>
<tr class="odd">
<td>[2, 3]</td>
<td>[2, 3]</td>
<td>[2, 3, 11]</td>
<td>[2, 3, null]</td>
<td>[]</td>
<td>[1]</td>
</tr>
<tr class="even">
<td>[2, 4]</td>
<td>[2]</td>
<td>[2, 4, 11]</td>
<td>[2, 4, null]</td>
<td>[4]</td>
<td>[4, 1, 3]</td>
</tr>
<tr class="odd">
<td>[3, 5]</td>
<td>[3]</td>
<td>[3, 5, 11]</td>
<td>[3, 5, null]</td>
<td>[5]</td>
<td>[5, 1, 2]</td>
</tr>
<tr class="even">
<td>[3, 6]</td>
<td>[3]</td>
<td>[3, 6, 11]</td>
<td>[3, 6, null]</td>
<td>[6]</td>
<td>[6, 1, 2]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Things to note:</p>
<ul>
<li>We can pass a Python list and not a Python set.</li>
<li>Set union with an appropriate dtype will return Null. Is that what you would expect?</li>
</ul>
</section>
<section id="polars-list-to-array-or-struct" class="level3">
<h3 class="anchored" data-anchor-id="polars-list-to-array-or-struct">Polars List to Array or Struct</h3>
<div id="cell-list-to-struct" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    df_with_list</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>),</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.to_struct().alias(<span class="st">'ab_struct'</span>),</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.to_array(width<span class="op">=</span><span class="dv">2</span>).alias(<span class="st">'ab_array'</span>),</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-to-struct" class="cell-output cell-output-display" data-execution_count="38">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 3)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ab</th>
<th data-quarto-table-cell-role="th">ab_struct</th>
<th data-quarto-table-cell-role="th">ab_array</th>
</tr>
<tr class="odd">
<th>list[i64]</th>
<th>struct[2]</th>
<th>array[i64, 2]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[1, 1]</td>
<td>{1,1}</td>
<td>[1, 1]</td>
</tr>
<tr class="even">
<td>[1, 2]</td>
<td>{1,2}</td>
<td>[1, 2]</td>
</tr>
<tr class="odd">
<td>[2, 3]</td>
<td>{2,3}</td>
<td>[2, 3]</td>
</tr>
<tr class="even">
<td>[2, 4]</td>
<td>{2,4}</td>
<td>[2, 4]</td>
</tr>
<tr class="odd">
<td>[3, 5]</td>
<td>{3,5}</td>
<td>[3, 5]</td>
</tr>
<tr class="even">
<td>[3, 6]</td>
<td>{3,6}</td>
<td>[3, 6]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Things to note:</p>
<ul>
<li>An array has a fixed length; it is not inferred, you must specify it.</li>
</ul>
</section>
</section>
<section id="sec-list-explode" class="level2">
<h2 class="anchored" data-anchor-id="sec-list-explode">Exploding and Imploding</h2>
<p><strong>Explode</strong>: from list onto a column.</p>
<div id="21e7dbcc" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    df_with_list</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.explode().alias(<span class="st">'ab_exploded'</span>),</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (12, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ab_exploded</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>1</td>
</tr>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
</tr>
<tr class="odd">
<td>2</td>
</tr>
<tr class="even">
<td>…</td>
</tr>
<tr class="odd">
<td>4</td>
</tr>
<tr class="even">
<td>3</td>
</tr>
<tr class="odd">
<td>5</td>
</tr>
<tr class="even">
<td>3</td>
</tr>
<tr class="odd">
<td>6</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p><strong>Implode</strong>: from column to list.</p>
<div id="1b5ae8a2" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>    df_with_list</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).implode().alias(<span class="st">'ab_imploded'</span>),</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.explode().implode().alias(<span class="st">'ab_exploded_imploded'</span>),</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ab_imploded</th>
<th data-quarto-table-cell-role="th">ab_exploded_imploded</th>
</tr>
<tr class="odd">
<th>list[list[i64]]</th>
<th>list[i64]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[[1, 1], [1, 2], … [3, 6]]</td>
<td>[1, 1, … 6]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>The following is a great trick to use when the <code>.list</code> namespace does not have the method you need.</p>
</div>
</div>
<p>Explode within a group will convert the list to a column, on which you can operate using usual <code>pl.col()</code> methods.</p>
<div id="1bc7fc7b" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>    df_with_list</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    .with_row_index()</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    .group_by(<span class="st">'index'</span>)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.explode() </span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>        .alias(<span class="st">'this_is_actually_a_column'</span>),</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">index</th>
<th data-quarto-table-cell-role="th">this_is_actually_a_column</th>
</tr>
<tr class="odd">
<th>u32</th>
<th>list[i64]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>[1, 1]</td>
</tr>
<tr class="even">
<td>1</td>
<td>[1, 2]</td>
</tr>
<tr class="odd">
<td>2</td>
<td>[2, 3]</td>
</tr>
<tr class="even">
<td>3</td>
<td>[2, 4]</td>
</tr>
<tr class="odd">
<td>4</td>
<td>[3, 5]</td>
</tr>
<tr class="even">
<td>5</td>
<td>[3, 6]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>There is also <code>df.explode()</code>, alongside the <code>pl.col().explode()</code> method.</p>
<div id="cell-df-explode" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>df_with_list.explode(<span class="st">'ab'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="df-explode" class="cell-output cell-output-display" data-execution_count="42">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (12, 3)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">b</th>
<th data-quarto-table-cell-role="th">ab</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>i64</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td>1</td>
<td>2</td>
<td>1</td>
</tr>
<tr class="even">
<td>1</td>
<td>2</td>
<td>2</td>
</tr>
<tr class="odd">
<td>2</td>
<td>3</td>
<td>2</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>2</td>
<td>4</td>
<td>4</td>
</tr>
<tr class="even">
<td>3</td>
<td>5</td>
<td>3</td>
</tr>
<tr class="odd">
<td>3</td>
<td>5</td>
<td>5</td>
</tr>
<tr class="even">
<td>3</td>
<td>6</td>
<td>3</td>
</tr>
<tr class="odd">
<td>3</td>
<td>6</td>
<td>6</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="examples" class="level2">
<h2 class="anchored" data-anchor-id="examples">Examples</h2>
<section id="sec-pct-change" class="level4">
<h4 class="anchored" data-anchor-id="sec-pct-change">pct_change</h4>
<p>In the absence of a <code>.list.pct_change()</code> method, we can use the following workaround.</p>
<div id="8594735e" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>    df_with_list</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    .with_row_index()</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    .group_by(<span class="st">'index'</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.explode().pct_change().alias(<span class="st">'pct_change'</span>),</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>        ) </span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">index</th>
<th data-quarto-table-cell-role="th">pct_change</th>
</tr>
<tr class="odd">
<th>u32</th>
<th>list[f64]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>[null, 0.0]</td>
</tr>
<tr class="even">
<td>1</td>
<td>[null, 1.0]</td>
</tr>
<tr class="odd">
<td>2</td>
<td>[null, 0.5]</td>
</tr>
<tr class="even">
<td>3</td>
<td>[null, 1.0]</td>
</tr>
<tr class="odd">
<td>4</td>
<td>[null, 0.666667]</td>
</tr>
<tr class="even">
<td>5</td>
<td>[null, 1.0]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Could I have done that with the multiple column approach? Would have needed <code>pl.col.pct_change_horizontal()</code>.</p>
</section>
<section id="sec-ecdf" class="level4">
<h4 class="anchored" data-anchor-id="sec-ecdf">ECDF</h4>
<p>How to compute within a column? In the abcense of <code>.list.ecdf()</code> and <code>pl.order_horizontal()</code>, we can use the following.</p>
<div id="cell-list-ecdf" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>    df_with_list</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>),</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Ranks</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.<span class="bu">eval</span>(pl.element().rank()).alias(<span class="st">'ranks'</span>),</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Option 1:ECDF with hard coded length (makes sense for an array)</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.<span class="bu">eval</span>(pl.element().rank().truediv(<span class="dv">2</span>)).alias(<span class="st">'ecdf_1'</span>),</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Option 2: ECDF with length of list. Will not work. </span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># pl.col('ab').list.eval(pl.element().rank().truediv(pl.col('ab').list.len())).alias('ecdf_2'),</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-ecdf" class="cell-output cell-output-display" data-execution_count="44">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 3)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ab</th>
<th data-quarto-table-cell-role="th">ranks</th>
<th data-quarto-table-cell-role="th">ecdf_1</th>
</tr>
<tr class="odd">
<th>list[i64]</th>
<th>list[f64]</th>
<th>list[f64]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[1, 1]</td>
<td>[1.5, 1.5]</td>
<td>[0.75, 0.75]</td>
</tr>
<tr class="even">
<td>[1, 2]</td>
<td>[1.0, 2.0]</td>
<td>[0.5, 1.0]</td>
</tr>
<tr class="odd">
<td>[2, 3]</td>
<td>[1.0, 2.0]</td>
<td>[0.5, 1.0]</td>
</tr>
<tr class="even">
<td>[2, 4]</td>
<td>[1.0, 2.0]</td>
<td>[0.5, 1.0]</td>
</tr>
<tr class="odd">
<td>[3, 5]</td>
<td>[1.0, 2.0]</td>
<td>[0.5, 1.0]</td>
</tr>
<tr class="even">
<td>[3, 6]</td>
<td>[1.0, 2.0]</td>
<td>[0.5, 1.0]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Things to note:</p>
<ul>
<li><p><code>.list.eval(pl.element())</code> can do more than point_wise operations. Think about the <code>rank()</code> example.</p></li>
<li><p>Option 2 will fail because <code>.list.eval()</code> cannot reference another column. See <a href="https://github.com/pola-rs/polars/issues/7210">issue</a>.</p></li>
<li><p><code>.rank()</code> has a <code>method</code> argument that can be used to specify how to deal with ties.</p></li>
</ul>
<p>Here is another attempt, which does not assume the length of the list is known (not fixed). The following will not work, but may be fixed.</p>
<div id="c92cc423" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>    df_with_list</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>    .with_row_index()</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    .group_by(<span class="st">'index'</span>)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>        (abrank<span class="op">:=</span>pl.col(<span class="st">'ab'</span>).explode().rank()).truediv(abrank.<span class="bu">len</span>()),</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">index</th>
<th data-quarto-table-cell-role="th">ab</th>
</tr>
<tr class="odd">
<th>u32</th>
<th>list[f64]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>[0.75, 0.75]</td>
</tr>
<tr class="even">
<td>1</td>
<td>[0.5, 1.0]</td>
</tr>
<tr class="odd">
<td>2</td>
<td>[0.5, 1.0]</td>
</tr>
<tr class="even">
<td>3</td>
<td>[0.5, 1.0]</td>
</tr>
<tr class="odd">
<td>4</td>
<td>[0.5, 1.0]</td>
</tr>
<tr class="even">
<td>5</td>
<td>[0.5, 1.0]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="ecdf-wrt-other-column" class="level4">
<h4 class="anchored" data-anchor-id="ecdf-wrt-other-column">ECDF wrt Other Column</h4>
<p><a href="#sec-ecdf" class="quarto-xref">Section&nbsp;2.5.0.2</a> showed how to compute the ECDF of a list. Say we want to evaluate the ECDF of column <code>a</code> wrt column <code>b</code>.</p>
<p>TODO</p>
<div id="696f8009" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>    df_with_list</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    .with_columns(pl.col(<span class="st">'a'</span>).implode())    </span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    .with_row_index()</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    .group_by(<span class="st">'index'</span>)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>        (</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>            a_ge_b_ind <span class="op">:=</span> pl.col(<span class="st">'a'</span>).explode().ge(pl.col(<span class="st">'b'</span>))</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>        a_ge_b_ind.<span class="bu">list</span>.<span class="bu">sum</span>().truediv(a_ge_b_ind.<span class="bu">list</span>.<span class="bu">len</span>())</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="arg_max_horizontal" class="level4">
<h4 class="anchored" data-anchor-id="arg_max_horizontal">arg_max_horizontal</h4>
<p>Note, there currently is no <code>pl.arg_max_horizontal()</code> method. We will try to make one by concatenating columns to list, and then using the <code>.list.arg_max()</code>. In particular, we will want the arg_max col name, and not the index.</p>
<div id="cell-arg-max-horizontal" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>    df</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Identify the arg_max</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>        pl.concat_list([pl.col(<span class="st">"a"</span>), pl.col(<span class="st">"b"</span>)])</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>        .<span class="bu">list</span>.arg_max()</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>        .alias(<span class="st">'arg_max'</span>),</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the name of the argmax</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'a'</span>,</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'b'</span>,</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>        (</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>            pl.col(<span class="st">'arg_max'</span>)</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>            .map_elements(<span class="kw">lambda</span> i: df.columns[i], return_dtype<span class="op">=</span>pl.Utf8)</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>            .alias(<span class="st">'arg_max_col_name'</span>)</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="arg-max-horizontal" class="cell-output cell-output-display" data-execution_count="46">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 3)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">b</th>
<th data-quarto-table-cell-role="th">arg_max_col_name</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>i64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1</td>
<td>"a"</td>
</tr>
<tr class="even">
<td>1</td>
<td>2</td>
<td>"b"</td>
</tr>
<tr class="odd">
<td>2</td>
<td>3</td>
<td>"b"</td>
</tr>
<tr class="even">
<td>2</td>
<td>4</td>
<td>"b"</td>
</tr>
<tr class="odd">
<td>3</td>
<td>5</td>
<td>"b"</td>
</tr>
<tr class="even">
<td>3</td>
<td>6</td>
<td>"b"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Things to note:</p>
<ul>
<li>Can you find a more efficient way to do this? Replacing the lambda?</li>
</ul>
</section>
<section id="quantile" class="level4">
<h4 class="anchored" data-anchor-id="quantile">Quantile</h4>
<p>Recall there is no <code>.list.quantile()</code> method; so we need to brew our own.</p>
<div id="cell-quantile-example" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>df_for_quantile <span class="op">=</span> (</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    df_with_list</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.sample(<span class="dv">100</span>, with_replacement<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>df_for_quantile.to_pandas()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="quantile-example" class="cell-output cell-output-display" data-execution_count="47">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ab</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>[1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, ...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>[2, 1, 2, 2, 1, 2, 1, 2, 2, 1, 2, 1, 2, 2, 1, ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>[2, 2, 2, 3, 3, 2, 2, 2, 3, 2, 2, 3, 2, 3, 2, ...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>[2, 4, 4, 4, 4, 4, 4, 2, 2, 2, 4, 4, 2, 4, 2, ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>[3, 5, 3, 5, 5, 3, 5, 5, 3, 5, 3, 3, 5, 5, 5, ...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>[3, 3, 6, 3, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, ...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>Option 1: <code>group_by</code> then <code>explode</code></p>
<div id="2edd513d" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>    df_for_quantile</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    .with_row_index()</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    .group_by(<span class="st">'index'</span>)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).explode().quantile(<span class="fl">0.2</span>)</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">index</th>
<th data-quarto-table-cell-role="th">ab</th>
</tr>
<tr class="odd">
<th>u32</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td>1</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td>2</td>
<td>2.0</td>
</tr>
<tr class="even">
<td>3</td>
<td>2.0</td>
</tr>
<tr class="odd">
<td>4</td>
<td>3.0</td>
</tr>
<tr class="even">
<td>5</td>
<td>3.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Option 2: <code>list.eval()</code></p>
<div id="05e7b945" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    df_for_quantile</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.<span class="bu">eval</span>(pl.element().quantile(<span class="fl">0.2</span>))</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>        .<span class="bu">list</span>.first() <span class="co"># to extract a float from a list</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>        .alias(<span class="st">'quantile_0.2'</span>),</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">quantile_0.2</th>
</tr>
<tr class="odd">
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1.0</td>
</tr>
<tr class="even">
<td>1.0</td>
</tr>
<tr class="odd">
<td>2.0</td>
</tr>
<tr class="even">
<td>2.0</td>
</tr>
<tr class="odd">
<td>3.0</td>
</tr>
<tr class="even">
<td>3.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="sec-array" class="level1">
<h1>Polars Array</h1>
<p>Polars Arrays as Polars lists with a fixed length.</p>
<section id="making-a-polars-array" class="level2">
<h2 class="anchored" data-anchor-id="making-a-polars-array">Making a Polars Array</h2>
<p>Make a Polars array from a Python list.</p>
<div id="cell-make-array" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>pl.DataFrame(</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>        pl.Series(<span class="st">"Array_1"</span>, [[<span class="dv">1</span>, <span class="dv">3</span>], [<span class="dv">2</span>, <span class="dv">5</span>]]),</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>        pl.Series(<span class="st">"Array_2"</span>, [[<span class="dv">1</span>, <span class="dv">7</span>, <span class="dv">3</span>], [<span class="dv">8</span>, <span class="dv">1</span>, <span class="dv">0</span>]]),</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>    schema<span class="op">=</span>{</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Array_1"</span>: pl.Array(pl.Int64, <span class="dv">2</span>),</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Array_2"</span>: pl.Array(pl.Int64, <span class="dv">3</span>),</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="make-array" class="cell-output cell-output-display" data-execution_count="50">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Array_1</th>
<th data-quarto-table-cell-role="th">Array_2</th>
</tr>
<tr class="odd">
<th>array[i64, 2]</th>
<th>array[i64, 3]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[1, 3]</td>
<td>[1, 7, 3]</td>
</tr>
<tr class="even">
<td>[2, 5]</td>
<td>[8, 1, 0]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Things to note:</p>
<ul>
<li>The dtype of the array is specified in the schema. Otherwise, a Polars list would have been inferred.</li>
</ul>
</section>
<section id="array-methods" class="level2">
<h2 class="anchored" data-anchor-id="array-methods">Array Methods</h2>
<p>Currently, list methods and array methods seem to be the same. I expect these lists to diverge in the future, because more operations can be defined when assuming a fixed length.</p>
</section>
</section>
<section id="sec-struct" class="level1">
<h1>Polars Struct</h1>
<p>Quoting <a href="https://www.rhosignal.com/posts/nested-dtypes/">RhoSignal</a>: &gt; pl.Struct type is a nested collection of columns. The pl.Struct is really just a way of having a nested namespace for columns. The underlying columns are just normal Polars Series.</p>
<p>Also from the <a href="https://wesm.github.io/arrow-site-test/format/Layout.html">Arrow documentation</a>: &gt; A struct is a nested type parameterized by an ordered sequence of relative types (which can all be distinct), called its fields.</p>
<p>So in summary:</p>
<ol start="2" type="1">
<li>The Python dict analogy is not a good one.</li>
<li>A Polars struct is a column which consists of another Polars dataframe.</li>
<li>There no difference in performance between a Polars struct and a set of columns (unless an entire field is null. See the <a href="https://wesm.github.io/arrow-site-test/format/Layout.html">Arrow documentation</a>).</li>
<li></li>
</ol>
<section id="making-a-polars-struct" class="level2">
<h2 class="anchored" data-anchor-id="making-a-polars-struct">Making a Polars Struct</h2>
<p>Make a Polars struct from a Python dict. But recall- there is nothing “Dicti” about the struct!</p>
<div id="cell-make-struct" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>pl.DataFrame(</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"a"</span>: [{<span class="st">"x"</span>: <span class="dv">1</span>, <span class="st">"y"</span>: <span class="dv">2</span>}, {<span class="st">"x"</span>: <span class="dv">3</span>, <span class="st">"y"</span>: <span class="dv">4</span>}, {<span class="st">"x"</span>: <span class="dv">5</span>, <span class="st">"y"</span>: <span class="dv">6</span>}],</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"b"</span>: [<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>]</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="make-struct" class="cell-output cell-output-display" data-execution_count="51">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">b</th>
</tr>
<tr class="odd">
<th>struct[2]</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>{1,2}</td>
<td>"a"</td>
</tr>
<tr class="even">
<td>{3,4}</td>
<td>"b"</td>
</tr>
<tr class="odd">
<td>{5,6}</td>
<td>"c"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>More often you will not make a Polars struct directly, but rather you will create one from a Polars DataFrame:</p>
<ol type="1">
<li>By directly creating a struct.</li>
<li>As the output of some operation, like <code>pl.Expr().value_counts()</code>, or all the horizontal cumulators like <code>pl.cum_sum_horizontal()</code>, <code>pl.cum_reduce()</code>, <code>pl.cum_fold()</code>, …</li>
<li>From a Polars list.</li>
<li>By splitting a string to a known length.</li>
</ol>
<section id="making-a-polars-struct-directly" class="level3">
<h3 class="anchored" data-anchor-id="making-a-polars-struct-directly">Making a Polars Struct Directly</h3>
<p><code>pl.struct()</code> with existing names:</p>
<div id="cell-make-struct-directly" class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>df_with_struct <span class="op">=</span> df.select(</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>    pl.struct([<span class="st">'a'</span>,<span class="st">'b'</span>])</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>    .alias(<span class="st">'struct'</span>)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>df_with_struct</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="make-struct-directly" class="cell-output cell-output-display" data-execution_count="52">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">struct</th>
</tr>
<tr class="odd">
<th>struct[2]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>{1,1}</td>
</tr>
<tr class="even">
<td>{1,2}</td>
</tr>
<tr class="odd">
<td>{2,3}</td>
</tr>
<tr class="even">
<td>{2,4}</td>
</tr>
<tr class="odd">
<td>{3,5}</td>
</tr>
<tr class="even">
<td>{3,6}</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Verify that the column is a struct:</p>
<div id="cell-verify-struct" class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>df_with_struct.schema</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="verify-struct" class="cell-output cell-output-display" data-execution_count="53">
<pre><code>OrderedDict([('struct', Struct({'a': Int64, 'b': Int64}))])</code></pre>
</div>
</div>
<p><code>pl.struct()</code> with field naming:</p>
<div id="f82242f9" class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>df.select(pl.struct(aaa<span class="op">=</span>pl.col(<span class="st">'a'</span>), bbb<span class="op">=</span>pl.col(<span class="st">'b'</span>))).schema</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<pre><code>OrderedDict([('aaa', Struct({'aaa': Int64, 'bbb': Int64}))])</code></pre>
</div>
</div>
</section>
<section id="struct-as-output" class="level3">
<h3 class="anchored" data-anchor-id="struct-as-output">Struct As Output</h3>
<div id="ed51dd24" class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>df.select(pl.col(<span class="st">'a'</span>).value_counts())</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="co"># df.select(pl.col('a').value_counts().struct.json_encode())</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>struct[2]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>{3,2}</td>
</tr>
<tr class="even">
<td>{1,2}</td>
</tr>
<tr class="odd">
<td>{2,2}</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="struct-from-list" class="level3">
<h3 class="anchored" data-anchor-id="struct-from-list">Struct From List</h3>
<p>When a list has constant length, which you want to access by name, it makes sense to convert it to a struct.</p>
<div id="cell-struct-from-list" class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>df_with_list.select(pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.to_struct().struct.json_encode())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="struct-from-list" class="cell-output cell-output-display" data-execution_count="56">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ab</th>
</tr>
<tr class="odd">
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"{"field_0":1,"field_1":1}"</td>
</tr>
<tr class="even">
<td>"{"field_0":1,"field_1":2}"</td>
</tr>
<tr class="odd">
<td>"{"field_0":2,"field_1":3}"</td>
</tr>
<tr class="even">
<td>"{"field_0":2,"field_1":4}"</td>
</tr>
<tr class="odd">
<td>"{"field_0":3,"field_1":5}"</td>
</tr>
<tr class="even">
<td>"{"field_0":3,"field_1":6}"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="split-a-string" class="level3">
<h3 class="anchored" data-anchor-id="split-a-string">Split a String</h3>
<p>If you want to govern the length of the output of a split, use <code>.str.splitn()</code> or <code>.str.split_exact()</code> instead of <code>.str.split()</code>.</p>
<div id="cell-struct-from-splitn" class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>    df_strings</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'a'</span>).<span class="bu">str</span>.splitn(<span class="st">","</span>,<span class="dv">4</span>)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="struct-from-splitn" class="cell-output cell-output-display" data-execution_count="57">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>struct[4]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>{"apple"," banana"," orange",null}</td>
</tr>
<tr class="even">
<td>{"apple"," banana",null,null}</td>
</tr>
<tr class="odd">
<td>{"apple",null,null,null}</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-struct-from-split-exact" class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>    df_strings</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'a'</span>).<span class="bu">str</span>.split_exact(<span class="st">","</span>,<span class="dv">4</span>)</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="struct-from-split-exact" class="cell-output cell-output-display" data-execution_count="58">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>struct[5]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>{"apple"," banana"," orange",null,null}</td>
</tr>
<tr class="even">
<td>{"apple"," banana",null,null,null}</td>
</tr>
<tr class="odd">
<td>{"apple",null,null,null,null}</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="struct-methods" class="level2">
<h2 class="anchored" data-anchor-id="struct-methods">Struct Methods</h2>
<section id="extracting-elements" class="level3">
<h3 class="anchored" data-anchor-id="extracting-elements">Extracting Elements</h3>
<p>Getting a field is actually getting a column from a sub-frame.</p>
<div id="cell-struct-get" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>    df_with_struct</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'struct'</span>).struct.field(<span class="st">'a'</span>),</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'struct'</span>).struct.field(<span class="st">'b'</span>),</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="struct-get" class="cell-output cell-output-display" data-execution_count="59">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">b</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td>1</td>
<td>2</td>
</tr>
<tr class="odd">
<td>2</td>
<td>3</td>
</tr>
<tr class="even">
<td>2</td>
<td>4</td>
</tr>
<tr class="odd">
<td>3</td>
<td>5</td>
</tr>
<tr class="even">
<td>3</td>
<td>6</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>To text in JSON format:</p>
<div id="cell-struct-to-json" class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>    df_with_struct</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'struct'</span>).struct.json_encode()</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="struct-to-json" class="cell-output cell-output-display" data-execution_count="60">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">struct</th>
</tr>
<tr class="odd">
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"{"a":1,"b":1}"</td>
</tr>
<tr class="even">
<td>"{"a":1,"b":2}"</td>
</tr>
<tr class="odd">
<td>"{"a":2,"b":3}"</td>
</tr>
<tr class="even">
<td>"{"a":2,"b":4}"</td>
</tr>
<tr class="odd">
<td>"{"a":3,"b":5}"</td>
</tr>
<tr class="even">
<td>"{"a":3,"b":6}"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="the-new-0.20.27-way-to-access-fields" class="level3">
<h3 class="anchored" data-anchor-id="the-new-0.20.27-way-to-access-fields">The New (&gt;= 0.20.27) Way to Access Fields</h3>
<p>As of version 0.20.27, you can access fields using a <code>.with_fields()</code> context, akin to the <code>.with_columns()</code> context.</p>
<div id="f39186bf" class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>    df_with_struct</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'struct'</span>).struct.with_fields(</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>            new_field <span class="op">=</span> pl.col(<span class="st">'struct'</span>).struct.field(<span class="st">'a'</span>) <span class="op">*</span> </span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>            pl.col(<span class="st">'struct'</span>).struct.field(<span class="st">'b'</span>)</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>        .struct.json_encode()</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="61">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">struct</th>
</tr>
<tr class="odd">
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"{"a":1,"b":1,"new_field":1}"</td>
</tr>
<tr class="even">
<td>"{"a":1,"b":2,"new_field":2}"</td>
</tr>
<tr class="odd">
<td>"{"a":2,"b":3,"new_field":6}"</td>
</tr>
<tr class="even">
<td>"{"a":2,"b":4,"new_field":8}"</td>
</tr>
<tr class="odd">
<td>"{"a":3,"b":5,"new_field":15}"</td>
</tr>
<tr class="even">
<td>"{"a":3,"b":6,"new_field":18}"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="struct-to-list" class="level2">
<h2 class="anchored" data-anchor-id="struct-to-list">Struct to List</h2>
<p>There is no <code>.struct.to_list()</code> method. This makes sense, since a struct does not require all fields to have the same dtype. In the case where all fields have the same dtype, you can use the following.</p>
<div id="cell-struct-to-list" class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>    df_with_struct</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>    .unnest(<span class="st">'struct'</span>) <span class="co">#from struct to columns</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>    .select(pl.concat_list(pl.<span class="bu">all</span>())) <span class="co"># from columns to list</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="struct-to-list" class="cell-output cell-output-display" data-execution_count="62">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>list[i64]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[1, 1]</td>
</tr>
<tr class="even">
<td>[1, 2]</td>
</tr>
<tr class="odd">
<td>[2, 3]</td>
</tr>
<tr class="even">
<td>[2, 4]</td>
</tr>
<tr class="odd">
<td>[3, 5]</td>
</tr>
<tr class="even">
<td>[3, 6]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>You can also consider element-by-element extractions.</p>
<div id="cell-struct-to-list-element-by-element" class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>    df_with_struct</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>        pl.concat_list([</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>            pl.col(<span class="st">'struct'</span>).struct.field(<span class="st">'a'</span>), </span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>            pl.col(<span class="st">'struct'</span>).struct.field(<span class="st">'b'</span>)</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>            ])</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="struct-to-list-element-by-element" class="cell-output cell-output-display" data-execution_count="63">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>list[i64]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[1, 1]</td>
</tr>
<tr class="even">
<td>[1, 2]</td>
</tr>
<tr class="odd">
<td>[2, 3]</td>
</tr>
<tr class="even">
<td>[2, 4]</td>
</tr>
<tr class="odd">
<td>[3, 5]</td>
</tr>
<tr class="even">
<td>[3, 6]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="examples-1" class="level2">
<h2 class="anchored" data-anchor-id="examples-1">Examples</h2>
<section id="verifying-multi-column-uniques-hashing" class="level3">
<h3 class="anchored" data-anchor-id="verifying-multi-column-uniques-hashing">Verifying Multi-Column Uniques (hashing)</h3>
<p>The <code>.expr().unique()</code> method does not accept multiple columns. We can use a struct to group the columns, and then apply the single-column <code>.unique()</code> method.</p>
<div id="cell-multi-column-uniques" class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>    df</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>        pl.struct([<span class="st">'a'</span>,<span class="st">'b'</span>]).alias(<span class="st">'struct'</span>)</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'struct'</span>).is_unique().alias(<span class="st">'unique_ind'</span>),</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'struct'</span>).<span class="bu">hash</span>().alias(<span class="st">'hash'</span>),</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="multi-column-uniques" class="cell-output cell-output-display" data-execution_count="64">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">unique_ind</th>
<th data-quarto-table-cell-role="th">hash</th>
</tr>
<tr class="odd">
<th>bool</th>
<th>u64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>true</td>
<td>7275562222371371866</td>
</tr>
<tr class="even">
<td>true</td>
<td>5001730839500661466</td>
</tr>
<tr class="odd">
<td>true</td>
<td>214433202675950699</td>
</tr>
<tr class="even">
<td>true</td>
<td>3276922812139959675</td>
</tr>
<tr class="odd">
<td>true</td>
<td>594759630009917312</td>
</tr>
<tr class="even">
<td>true</td>
<td>12464129093563214397</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="discussion" class="level1">
<h1>Discussion</h1>
<section id="q-can-i-have-a-list-of-list-of-lists-i.e.-more-than-2-layers-of-nesting" class="level3">
<h3 class="anchored" data-anchor-id="q-can-i-have-a-list-of-list-of-lists-i.e.-more-than-2-layers-of-nesting">Q: Can I have a list of list of lists (i.e.&nbsp;more than 2 layers of nesting)?</h3>
<p>Yes.</p>
</section>
<section id="can-i-use-list-methods-on-a-structe.g.-argmax" class="level3">
<h3 class="anchored" data-anchor-id="can-i-use-list-methods-on-a-structe.g.-argmax">Can I use list methods on a struct?(e.g.&nbsp;argmax)</h3>
<p>No.&nbsp;But you can extract the struct to a list, and then use list methods.</p>
</section>
<section id="q-when-a-polars-list-and-when-a-set-of-columns" class="level3">
<h3 class="anchored" data-anchor-id="q-when-a-polars-list-and-when-a-set-of-columns">Q: When a Polars List and when a set of columns?</h3>
<p>The difference is mostly syntactic. So a matter of preference and convenience. See the following example. The same goes for Polars arrays.</p>
<div id="daeaec01" class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make a frame with lists of random length</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>max_length <span class="op">=</span> <span class="bu">int</span>(<span class="fl">1e6</span>)</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_list():</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> pl.Series(<span class="bu">list</span>(string.ascii_letters)).sample(random.randint(<span class="dv">1</span>, max_length), with_replacement<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a><span class="co"># make_list()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="9bdc20c2" class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pl.DataFrame(</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"a"</span>: [make_list(), make_list(), make_list()],</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"b"</span>: [<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>]</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="a27c3e6b" class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>df.estimated_size(unit<span class="op">=</span><span class="st">'mb'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="67">
<pre><code>1.3414945602416992</code></pre>
</div>
</div>
<div id="3a800a25" class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>df_2 <span class="op">=</span> df.select(pl.col(<span class="st">'a'</span>).<span class="bu">list</span>.to_struct(n_field_strategy<span class="op">=</span><span class="st">'max_width'</span>)).unnest(<span class="st">"a"</span>)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>df_2.estimated_size(unit<span class="op">=</span><span class="st">'mb'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="68">
<pre><code>1.3414688110351562</code></pre>
</div>
</div>
<div id="7e01bebc" class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %timeit df_2.select(pl.col('a').str.len_chars())</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="can-i-export-to-csv-to-parquet" class="level3">
<h3 class="anchored" data-anchor-id="can-i-export-to-csv-to-parquet">Can I export to CSV? To Parquet?</h3>
<div id="f7a76d16" class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get tmp file name from operating system</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tempfile</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>temp_file <span class="op">=</span> os.path.join(tempfile._get_default_tempdir(), <span class="st">'something.csv'</span>)</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>df_with_list.write_csv(<span class="st">'df_with_list.csv'</span>)</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>df_with_list.write_parquet(<span class="st">'df_with_list.parquet'</span>)</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>pl.read_parquet(<span class="st">'df_with_list.parquet'</span>).schema</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What is the dtype when I export to Pandas?</p>
<div id="export-to-pandas" class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>df_with_list_pandas <span class="op">=</span> df_with_list.to_pandas()</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>df_with_list_pandas.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 6 entries, 0 to 5
Data columns (total 3 columns):
 #   Column  Non-Null Count  Dtype 
---  ------  --------------  ----- 
 0   a       6 non-null      int64 
 1   b       6 non-null      int64 
 2   ab      6 non-null      object
dtypes: int64(2), object(1)
memory usage: 276.0+ bytes</code></pre>
</div>
</div>
</section>
<section id="q-what-is-the-namespace-for-a-list-of-lists" class="level3">
<h3 class="anchored" data-anchor-id="q-what-is-the-namespace-for-a-list-of-lists">Q: What is the namespace for a list of lists?</h3>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>
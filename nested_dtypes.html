<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Nested dtypes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="nested_dtypes_files/libs/clipboard/clipboard.min.js"></script>
<script src="nested_dtypes_files/libs/quarto-html/quarto.js"></script>
<script src="nested_dtypes_files/libs/quarto-html/popper.min.js"></script>
<script src="nested_dtypes_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="nested_dtypes_files/libs/quarto-html/anchor.min.js"></script>
<link href="nested_dtypes_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="nested_dtypes_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="nested_dtypes_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="nested_dtypes_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="nested_dtypes_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Nested dtypes</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div id="setup-env" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %pip install -r requirements.txt</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="polars-version" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>pip show Polars <span class="co"># check you Polars version</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Name: polars
Version: 0.20.19
Summary: Blazingly fast DataFrame library
Home-page: 
Author: 
Author-email: Ritchie Vink &lt;ritchie46@gmail.com&gt;
License: 
Location: /Users/johnros/workspace/polars_demo/.venv/lib/python3.9/site-packages
Requires: 
Required-by: 
Note: you may need to restart the kernel to use updated packages.</code></pre>
</div>
</div>
<div id="pandas-version" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>pip show Pandas <span class="co"># check you Pandas version</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Name: pandas
Version: 2.2.2
Summary: Powerful data structures for data analysis, time series, and statistics
Home-page: https://pandas.pydata.org
Author: 
Author-email: The Pandas Development Team &lt;pandas-dev@python.org&gt;
License: BSD 3-Clause License
        
        Copyright (c) 2008-2011, AQR Capital Management, LLC, Lambda Foundry, Inc. and PyData Development Team
        All rights reserved.
        
        Copyright (c) 2011-2023, Open source contributors.
        
        Redistribution and use in source and binary forms, with or without
        modification, are permitted provided that the following conditions are met:
        
        * Redistributions of source code must retain the above copyright notice, this
          list of conditions and the following disclaimer.
        
        * Redistributions in binary form must reproduce the above copyright notice,
          this list of conditions and the following disclaimer in the documentation
          and/or other materials provided with the distribution.
        
        * Neither the name of the copyright holder nor the names of its
          contributors may be used to endorse or promote products derived from
          this software without specific prior written permission.
        
        THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
        AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
        IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
        DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
        FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
        DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
        SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
        CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
        OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
        OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
Location: /Users/johnros/workspace/polars_demo/.venv/lib/python3.9/site-packages
Requires: numpy, python-dateutil, pytz, tzdata
Required-by: bokeh, category-encoders, great-tables, holoviews, hvplot, mizani, panel, seaborn, statsmodels
Note: you may need to restart the kernel to use updated packages.</code></pre>
</div>
</div>
<div id="preliminaries" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars <span class="im">as</span> pl</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>pl.Config(fmt_str_lengths<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars.selectors <span class="im">as</span> cs</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyarrow <span class="im">as</span> pa</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> string</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Following two lines only required to view plotly when rendering from VScode. </span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.io <span class="im">as</span> pio</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co"># pio.renderers.default = "plotly_mimetype+notebook_connected+notebook"</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>pio.renderers.default <span class="op">=</span> <span class="st">"plotly_mimetype+notebook"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What Polars module and dependencies are installed?</p>
<div id="show-versions" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>pl.show_versions()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>--------Version info---------
Polars:               0.20.19
Index type:           UInt32
Platform:             macOS-14.4-arm64-arm-64bit
Python:               3.9.6 (default, Nov 10 2023, 13:38:27) 
[Clang 15.0.0 (clang-1500.1.0.2.5)]

----Optional dependencies----
adbc_driver_manager:  &lt;not installed&gt;
cloudpickle:          &lt;not installed&gt;
connectorx:           &lt;not installed&gt;
deltalake:            &lt;not installed&gt;
fastexcel:            &lt;not installed&gt;
fsspec:               2023.9.0
gevent:               &lt;not installed&gt;
hvplot:               0.9.2
matplotlib:           3.6.3
nest_asyncio:         1.5.6
numpy:                1.24.1
openpyxl:             &lt;not installed&gt;
pandas:               2.2.2
pyarrow:              15.0.2
pydantic:             &lt;not installed&gt;
pyiceberg:            &lt;not installed&gt;
pyxlsb:               &lt;not installed&gt;
sqlalchemy:           1.4.46
xlsx2csv:             &lt;not installed&gt;
xlsxwriter:           &lt;not installed&gt;</code></pre>
</div>
</div>
<p>How many cores are available for parallelism?</p>
<div id="cell-show-cores" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>pl.thread_pool_size()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="show-cores" class="cell-output cell-output-display" data-execution_count="7">
<pre><code>8</code></pre>
</div>
</div>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Recall the nested dtypes:</p>
<ol type="1">
<li>Polars Struct: Like a Python dict within a cell; Multiple named elements.</li>
<li>Polars List: Similar to a Python list within a cell; Multiple unnamed elements. Unlike the Python list, in a Polars list, all elements must have the same dtype.</li>
<li>Polars Array: Like a Polars list, but with a fixed length for all cells in the column.</li>
</ol>
</section>
<section id="sec-list" class="level1">
<h1>Polars List</h1>
<section id="making-a-polars-list" class="level2">
<h2 class="anchored" data-anchor-id="making-a-polars-list">Making a Polars List</h2>
<p>Make a Polars list from a Python list.</p>
<div id="cell-make-list" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>pl.DataFrame(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"a"</span>: [[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>], [<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>], [<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>]],</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"b"</span>: [<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>]</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="make-list" class="cell-output cell-output-display" data-execution_count="8">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">b</th>
</tr>
<tr class="odd">
<th>list[i64]</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[1, 2, 3]</td>
<td>"a"</td>
</tr>
<tr class="even">
<td>[4, 5, 6]</td>
<td>"b"</td>
</tr>
<tr class="odd">
<td>[7, 8, 9]</td>
<td>"c"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Things to note:</p>
<ul>
<li><code>a</code> is not a Python list, rather, it is a Polars list. There are differences between the two. For instance, all elements in a Polars list must have the same dtype. Also, the Polars list is a columnar data structure, which is more efficient for certain operations. Finally, the Polars list is a first-class citizen in the Polars API, with its own methods and functions.</li>
<li>Can a Polars list hold a polars list? Yes. See the next example.</li>
</ul>
<p>Make a Polars list of Polars lists:</p>
<div id="cell-make-list-of-list" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>pl.DataFrame(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"a"</span>: [[[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>], [<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>], [<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>]], [[<span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>], [<span class="dv">13</span>, <span class="dv">14</span>, <span class="dv">15</span>], [<span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">18</span>]]],</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"b"</span>: [<span class="st">"a"</span>, <span class="st">"b"</span>]</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="make-list-of-list" class="cell-output cell-output-display" data-execution_count="9">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">b</th>
</tr>
<tr class="odd">
<th>list[list[i64]]</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[[1, 2, 3], [4, 5, 6], [7, 8, 9]]</td>
<td>"a"</td>
</tr>
<tr class="even">
<td>[[10, 11, 12], [13, 14, 15], [16, 17, 18]]</td>
<td>"b"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>More often you will not make a Polars list directly, but rather you will create one from a Polars DataFrame:</p>
<ol type="1">
<li>When grouping without aggregation.</li>
<li>When wrapping a bunch of columns with <code>pl.concat_list()</code>.</li>
<li>When “imploding” (aka “collapsing”) an <code>pl.Expr()</code>.</li>
</ol>
<p>List from aggregation:</p>
<div id="cell-list-from-aggregation" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pl.DataFrame(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"a"</span>: [<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>],</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"b"</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>]</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>df.group_by(<span class="st">"a"</span>).agg(pl.col(<span class="st">"b"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-from-aggregation" class="cell-output cell-output-display" data-execution_count="10">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">b</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>list[i64]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>[1, 2]</td>
</tr>
<tr class="even">
<td>2</td>
<td>[3, 4]</td>
</tr>
<tr class="odd">
<td>3</td>
<td>[5, 6]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>List from concatenation of pl.Exprs():</p>
<div id="cell-list-from-concatenation" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df.select(pl.concat_list([pl.col(<span class="st">"a"</span>), pl.col(<span class="st">"b"</span>)]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-from-concatenation" class="cell-output cell-output-display" data-execution_count="11">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>list[i64]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[1, 1]</td>
</tr>
<tr class="even">
<td>[1, 2]</td>
</tr>
<tr class="odd">
<td>[2, 3]</td>
</tr>
<tr class="even">
<td>[2, 4]</td>
</tr>
<tr class="odd">
<td>[3, 5]</td>
</tr>
<tr class="even">
<td>[3, 6]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>List from concatenation of pl.Lists:</p>
<div id="1eb83c64" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    df</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>        pl.concat_list([pl.col(<span class="st">"a"</span>), pl.col(<span class="st">"b"</span>)]).alias(<span class="st">'ab'</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    .with_columns(pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.concat(<span class="st">'ab'</span>))</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    .to_pandas()</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ab</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>[1, 1, 1, 1]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>[1, 2, 1, 2]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>[2, 3, 2, 3]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>[2, 4, 2, 4]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>[3, 5, 3, 5]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>[3, 6, 3, 6]</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>List from imploding an <code>pl.Expr()</code>:</p>
<div id="cell-list-from-imploding" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df.with_columns(pl.col(<span class="st">"b"</span>).implode())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-from-imploding" class="cell-output cell-output-display" data-execution_count="13">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">b</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>list[i64]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>[1, 2, … 6]</td>
</tr>
<tr class="even">
<td>1</td>
<td>[1, 2, … 6]</td>
</tr>
<tr class="odd">
<td>2</td>
<td>[1, 2, … 6]</td>
</tr>
<tr class="even">
<td>2</td>
<td>[1, 2, … 6]</td>
</tr>
<tr class="odd">
<td>3</td>
<td>[1, 2, … 6]</td>
</tr>
<tr class="even">
<td>3</td>
<td>[1, 2, … 6]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Implode within group:</p>
<div id="cell-implode-within-group" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df.group_by(<span class="st">"a"</span>).agg(pl.col(<span class="st">"b"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="implode-within-group" class="cell-output cell-output-display" data-execution_count="14">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">b</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>list[i64]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3</td>
<td>[5, 6]</td>
</tr>
<tr class="even">
<td>2</td>
<td>[3, 4]</td>
</tr>
<tr class="odd">
<td>1</td>
<td>[1, 2]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Implode over:</p>
<div id="implode-over" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df.with_columns(pl.col(<span class="st">"b"</span>).over(<span class="st">"a"</span>)) <span class="co"># no good</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>df.with_columns(pl.col(<span class="st">"b"</span>).implode().over(<span class="st">"a"</span>)) <span class="co"># no good</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>df.with_columns(pl.concat_list(<span class="st">'b'</span>).over(<span class="st">"a"</span>)) <span class="co"># no good</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="faed5f3a" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>df.with_columns(pl.col(<span class="st">"b"</span>).over(<span class="st">"a"</span>, mapping_strategy<span class="op">=</span><span class="st">"join"</span>)) <span class="co"># good!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">b</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>list[i64]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>[1, 2]</td>
</tr>
<tr class="even">
<td>1</td>
<td>[1, 2]</td>
</tr>
<tr class="odd">
<td>2</td>
<td>[3, 4]</td>
</tr>
<tr class="even">
<td>2</td>
<td>[3, 4]</td>
</tr>
<tr class="odd">
<td>3</td>
<td>[5, 6]</td>
</tr>
<tr class="even">
<td>3</td>
<td>[5, 6]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>See <a href="https://github.com/pola-rs/polars/pull/6487">here</a> for more context.</p>
<section id="more-on-.overmapping_strategy..." class="level3">
<h3 class="anchored" data-anchor-id="more-on-.overmapping_strategy...">More on <code>.over(mapping_strategy=...)</code></h3>
<p>TODO</p>
</section>
</section>
<section id="operating-on-list-elements" class="level2">
<h2 class="anchored" data-anchor-id="operating-on-list-elements">Operating on List Elements</h2>
<p>The most general way is to use <code>list.eval(pl.element())</code>:</p>
<div id="cell-list-eval-element" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>df_with_list <span class="op">=</span> df.with_columns(pl.concat_list([pl.col(<span class="st">"a"</span>), pl.col(<span class="st">"b"</span>)]).alias(<span class="st">'ab'</span>))</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    df_with_list</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.<span class="bu">eval</span>(pl.element().add(<span class="dv">1000</span>))</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-eval-element" class="cell-output cell-output-display" data-execution_count="16">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ab</th>
</tr>
<tr class="odd">
<th>list[i64]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[1001, 1001]</td>
</tr>
<tr class="even">
<td>[1001, 1002]</td>
</tr>
<tr class="odd">
<td>[1002, 1003]</td>
</tr>
<tr class="even">
<td>[1002, 1004]</td>
</tr>
<tr class="odd">
<td>[1003, 1005]</td>
</tr>
<tr class="even">
<td>[1003, 1006]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Things to note:</p>
<ul>
<li><code>.eval()</code> belongs to the <code>.list</code> namespace.</li>
<li><code>pl.element()</code> is a selector that selects the elements of the list. It has almost all the methods available to <code>pl.col()</code>.</li>
</ul>
<div id="list-eval-element-methods" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">dir</span>(pl.element()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['__abs__', '__add__', '__and__', '__annotations__', '__array_ufunc__', '__bool__', '__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__floordiv__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__invert__', '__le__', '__lt__', '__mod__', '__module__', '__mul__', '__ne__', '__neg__', '__new__', '__or__', '__pos__', '__pow__', '__radd__', '__rand__', '__reduce__', '__reduce_ex__', '__repr__', '__rfloordiv__', '__rmod__', '__rmul__', '__ror__', '__rpow__', '__rsub__', '__rtruediv__', '__rxor__', '__setattr__', '__setstate__', '__sizeof__', '__str__', '__sub__', '__subclasshook__', '__truediv__', '__weakref__', '__xor__', '_accessors', '_from_pyexpr', '_map_batches_wrapper', '_pyexpr', '_register_plugin', '_repr_html_', 'abs', 'add', 'agg_groups', 'alias', 'all', 'and_', 'any', 'append', 'apply', 'approx_n_unique', 'arccos', 'arccosh', 'arcsin', 'arcsinh', 'arctan', 'arctanh', 'arg_max', 'arg_min', 'arg_sort', 'arg_true', 'arg_unique', 'arr', 'backward_fill', 'bin', 'bottom_k', 'cast', 'cat', 'cbrt', 'ceil', 'clip', 'clip_max', 'clip_min', 'cos', 'cosh', 'cot', 'count', 'cum_count', 'cum_max', 'cum_min', 'cum_prod', 'cum_sum', 'cumcount', 'cummax', 'cummin', 'cumprod', 'cumsum', 'cumulative_eval', 'cut', 'degrees', 'deserialize', 'diff', 'dot', 'drop_nans', 'drop_nulls', 'dt', 'entropy', 'eq', 'eq_missing', 'ewm_mean', 'ewm_std', 'ewm_var', 'exclude', 'exp', 'explode', 'extend_constant', 'fill_nan', 'fill_null', 'filter', 'first', 'flatten', 'floor', 'floordiv', 'forward_fill', 'from_json', 'gather', 'gather_every', 'ge', 'get', 'gt', 'hash', 'head', 'hist', 'implode', 'inspect', 'interpolate', 'is_between', 'is_duplicated', 'is_finite', 'is_first', 'is_first_distinct', 'is_in', 'is_infinite', 'is_last', 'is_last_distinct', 'is_nan', 'is_not', 'is_not_nan', 'is_not_null', 'is_null', 'is_unique', 'keep_name', 'kurtosis', 'last', 'le', 'len', 'limit', 'list', 'log', 'log10', 'log1p', 'lower_bound', 'lt', 'map', 'map_alias', 'map_batches', 'map_dict', 'map_elements', 'max', 'mean', 'median', 'meta', 'min', 'mod', 'mode', 'mul', 'n_unique', 'name', 'nan_max', 'nan_min', 'ne', 'ne_missing', 'neg', 'not_', 'null_count', 'or_', 'over', 'pct_change', 'peak_max', 'peak_min', 'pipe', 'pow', 'prefix', 'product', 'qcut', 'quantile', 'radians', 'rank', 'rechunk', 'register_plugin', 'reinterpret', 'repeat_by', 'replace', 'reshape', 'reverse', 'rle', 'rle_id', 'rolling', 'rolling_apply', 'rolling_map', 'rolling_max', 'rolling_mean', 'rolling_median', 'rolling_min', 'rolling_quantile', 'rolling_skew', 'rolling_std', 'rolling_sum', 'rolling_var', 'round', 'round_sig_figs', 'sample', 'search_sorted', 'set_sorted', 'shift', 'shift_and_fill', 'shrink_dtype', 'shuffle', 'sign', 'sin', 'sinh', 'skew', 'slice', 'sort', 'sort_by', 'sqrt', 'std', 'str', 'struct', 'sub', 'suffix', 'sum', 'tail', 'take', 'take_every', 'tan', 'tanh', 'to_physical', 'top_k', 'truediv', 'unique', 'unique_counts', 'upper_bound', 'value_counts', 'var', 'where', 'xor']</code></pre>
</div>
</div>
</section>
<section id="list-methods" class="level2">
<h2 class="anchored" data-anchor-id="list-methods">List Methods</h2>
<p><code>.list.eval(pl.element())</code> will operate one element at a time. If you want to operate on the list as a whole, you can wither use existing <a href="https://docs.pola.rs/py-polars/html/reference/expressions/list.html">list methods</a>, or use <code>pl.col()</code> methods, after exploding the list (see <a href="#sec-list-explode" class="quarto-xref">Section&nbsp;2.4</a>).</p>
<p>We now demonstrate some of the list methods.</p>
<section id="selecting-elements" class="level3">
<h3 class="anchored" data-anchor-id="selecting-elements">Selecting Elements</h3>
<p>Get, Gather, Slice, Gather_Every</p>
<div id="cell-list-get-and-gather" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    df_with_list.select(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>),</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.get(<span class="dv">0</span>).alias(<span class="st">'get_1'</span>), </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.gather([<span class="dv">0</span>]).alias(<span class="st">'gather_1'</span>), <span class="co"># returns a list</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.<span class="bu">slice</span>(<span class="dv">0</span>,<span class="dv">1</span>).alias(<span class="st">'slice_1'</span>), <span class="co"># returns a list</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.gather([<span class="dv">0</span>, <span class="dv">1</span>]).alias(<span class="st">'gather_2'</span>),</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.<span class="bu">slice</span>(<span class="dv">0</span>,<span class="dv">2</span>).alias(<span class="st">'slice_2'</span>),</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.gather_every(<span class="dv">2</span>).alias(<span class="st">'gather_every_2'</span>),</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-get-and-gather" class="cell-output cell-output-display" data-execution_count="18">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 7)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ab</th>
<th data-quarto-table-cell-role="th">get_1</th>
<th data-quarto-table-cell-role="th">gather_1</th>
<th data-quarto-table-cell-role="th">slice_1</th>
<th data-quarto-table-cell-role="th">gather_2</th>
<th data-quarto-table-cell-role="th">slice_2</th>
<th data-quarto-table-cell-role="th">gather_every_2</th>
</tr>
<tr class="odd">
<th>list[i64]</th>
<th>i64</th>
<th>list[i64]</th>
<th>list[i64]</th>
<th>list[i64]</th>
<th>list[i64]</th>
<th>list[i64]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[1, 1]</td>
<td>1</td>
<td>[1]</td>
<td>[1]</td>
<td>[1, 1]</td>
<td>[1, 1]</td>
<td>[1]</td>
</tr>
<tr class="even">
<td>[1, 2]</td>
<td>1</td>
<td>[1]</td>
<td>[1]</td>
<td>[1, 2]</td>
<td>[1, 2]</td>
<td>[1]</td>
</tr>
<tr class="odd">
<td>[2, 3]</td>
<td>2</td>
<td>[2]</td>
<td>[2]</td>
<td>[2, 3]</td>
<td>[2, 3]</td>
<td>[2]</td>
</tr>
<tr class="even">
<td>[2, 4]</td>
<td>2</td>
<td>[2]</td>
<td>[2]</td>
<td>[2, 4]</td>
<td>[2, 4]</td>
<td>[2]</td>
</tr>
<tr class="odd">
<td>[3, 5]</td>
<td>3</td>
<td>[3]</td>
<td>[3]</td>
<td>[3, 5]</td>
<td>[3, 5]</td>
<td>[3]</td>
</tr>
<tr class="even">
<td>[3, 6]</td>
<td>3</td>
<td>[3]</td>
<td>[3]</td>
<td>[3, 6]</td>
<td>[3, 6]</td>
<td>[3]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>First, Head, Last, Tail</p>
<div id="cell-list-methods" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    df_with_list.select(</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>),</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.get(<span class="dv">1</span>).alias(<span class="st">'first_1'</span>),</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.first().alias(<span class="st">'first_2'</span>),</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.head(<span class="dv">1</span>).alias(<span class="st">'first_5'</span>), <span class="co"># returns a list</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.last().alias(<span class="st">'last_2'</span>), </span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.tail(<span class="dv">1</span>).alias(<span class="st">'last_1'</span>), <span class="co"># returns a list</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.tail(<span class="dv">1</span>).<span class="bu">list</span>.first().alias(<span class="st">'last_3'</span>),</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-methods" class="cell-output cell-output-display" data-execution_count="19">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 7)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ab</th>
<th data-quarto-table-cell-role="th">first_1</th>
<th data-quarto-table-cell-role="th">first_2</th>
<th data-quarto-table-cell-role="th">first_5</th>
<th data-quarto-table-cell-role="th">last_2</th>
<th data-quarto-table-cell-role="th">last_1</th>
<th data-quarto-table-cell-role="th">last_3</th>
</tr>
<tr class="odd">
<th>list[i64]</th>
<th>i64</th>
<th>i64</th>
<th>list[i64]</th>
<th>i64</th>
<th>list[i64]</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[1, 1]</td>
<td>1</td>
<td>1</td>
<td>[1]</td>
<td>1</td>
<td>[1]</td>
<td>1</td>
</tr>
<tr class="even">
<td>[1, 2]</td>
<td>2</td>
<td>1</td>
<td>[1]</td>
<td>2</td>
<td>[2]</td>
<td>2</td>
</tr>
<tr class="odd">
<td>[2, 3]</td>
<td>3</td>
<td>2</td>
<td>[2]</td>
<td>3</td>
<td>[3]</td>
<td>3</td>
</tr>
<tr class="even">
<td>[2, 4]</td>
<td>4</td>
<td>2</td>
<td>[2]</td>
<td>4</td>
<td>[4]</td>
<td>4</td>
</tr>
<tr class="odd">
<td>[3, 5]</td>
<td>5</td>
<td>3</td>
<td>[3]</td>
<td>5</td>
<td>[5]</td>
<td>5</td>
</tr>
<tr class="even">
<td>[3, 6]</td>
<td>6</td>
<td>3</td>
<td>[3]</td>
<td>6</td>
<td>[6]</td>
<td>6</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Shift</p>
<div id="cell-list-shift" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    df_with_list.select(</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>),</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.shift(<span class="dv">1</span>).alias(<span class="st">'shift_1'</span>),</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.shift(<span class="op">-</span><span class="dv">1</span>).alias(<span class="st">'shift_-1'</span>),</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-shift" class="cell-output cell-output-display" data-execution_count="20">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 3)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ab</th>
<th data-quarto-table-cell-role="th">shift_1</th>
<th data-quarto-table-cell-role="th">shift_-1</th>
</tr>
<tr class="odd">
<th>list[i64]</th>
<th>list[i64]</th>
<th>list[i64]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[1, 1]</td>
<td>[null, 1]</td>
<td>[1, null]</td>
</tr>
<tr class="even">
<td>[1, 2]</td>
<td>[null, 1]</td>
<td>[2, null]</td>
</tr>
<tr class="odd">
<td>[2, 3]</td>
<td>[null, 2]</td>
<td>[3, null]</td>
</tr>
<tr class="even">
<td>[2, 4]</td>
<td>[null, 2]</td>
<td>[4, null]</td>
</tr>
<tr class="odd">
<td>[3, 5]</td>
<td>[null, 3]</td>
<td>[5, null]</td>
</tr>
<tr class="even">
<td>[3, 6]</td>
<td>[null, 3]</td>
<td>[6, null]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Sample</p>
<div id="cell-list-sample" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    df_with_list.select(</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>),</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.sample(<span class="dv">10</span>, with_replacement<span class="op">=</span><span class="va">True</span>).alias(<span class="st">'sample'</span>),</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    .to_pandas()</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-sample" class="cell-output cell-output-display" data-execution_count="21">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ab</th>
<th data-quarto-table-cell-role="th">sample</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>[1, 1]</td>
<td>[1, 1, 1, 1, 1, 1, 1, 1, 1, 1]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>[1, 2]</td>
<td>[2, 1, 1, 2, 1, 1, 2, 1, 2, 1]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>[2, 3]</td>
<td>[2, 2, 3, 2, 3, 3, 2, 3, 2, 2]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>[2, 4]</td>
<td>[2, 2, 2, 2, 4, 4, 4, 2, 4, 4]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>[3, 5]</td>
<td>[3, 5, 3, 5, 5, 3, 3, 5, 3, 3]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>[3, 6]</td>
<td>[6, 3, 6, 6, 3, 3, 6, 6, 3, 3]</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>Careful where you put the <code>.sample()</code>!</p>
<div id="032de252" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    df_with_list</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.sample(<span class="dv">10</span>, with_replacement<span class="op">=</span><span class="va">True</span>).alias(<span class="st">'within_row'</span>),</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).sample(<span class="dv">6</span>, with_replacement<span class="op">=</span><span class="va">True</span>).alias(<span class="st">'within_column'</span>),</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    .to_pandas()</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">within_row</th>
<th data-quarto-table-cell-role="th">within_column</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>[1, 1, 1, 1, 1, 1, 1, 1, 1, 1]</td>
<td>[2, 3]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>[1, 1, 1, 2, 1, 2, 2, 2, 1, 1]</td>
<td>[2, 4]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>[2, 3, 3, 2, 3, 2, 3, 2, 2, 3]</td>
<td>[3, 6]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>[4, 4, 4, 4, 4, 4, 2, 4, 4, 4]</td>
<td>[1, 2]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>[3, 5, 5, 3, 3, 3, 5, 5, 3, 3]</td>
<td>[2, 3]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>[6, 3, 3, 3, 6, 3, 6, 3, 6, 6]</td>
<td>[2, 3]</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</section>
<section id="filtering" class="level3">
<h3 class="anchored" data-anchor-id="filtering">Filtering</h3>
<div id="cell-list-filter" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    df_with_list</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>),</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.<span class="bu">eval</span>(pl.element().gt(<span class="dv">2</span>)).alias(<span class="st">'gt_2'</span>),</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># pl.col('ab').list.filter(pl.col('ab').list.gt(5)).alias('gt_5'), # not implemented yet</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-filter" class="cell-output cell-output-display" data-execution_count="23">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ab</th>
<th data-quarto-table-cell-role="th">gt_2</th>
</tr>
<tr class="odd">
<th>list[i64]</th>
<th>list[bool]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[1, 1]</td>
<td>[false, false]</td>
</tr>
<tr class="even">
<td>[1, 2]</td>
<td>[false, false]</td>
</tr>
<tr class="odd">
<td>[2, 3]</td>
<td>[false, true]</td>
</tr>
<tr class="even">
<td>[2, 4]</td>
<td>[false, true]</td>
</tr>
<tr class="odd">
<td>[3, 5]</td>
<td>[true, true]</td>
</tr>
<tr class="even">
<td>[3, 6]</td>
<td>[true, true]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="statistical-aggregations" class="level3">
<h3 class="anchored" data-anchor-id="statistical-aggregations">Statistical Aggregations</h3>
<p>.arg_max:</p>
<p>.arg_min:</p>
<p>.var:</p>
<p>.std:</p>
<p>.n_unique:</p>
<p>.unique:</p>
<p>.min:</p>
<p>.max:</p>
<p>.sum:</p>
<p>.mean:</p>
<p>.median:</p>
<p>.len</p>
<div id="cell-list-statistical-aggregations" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    df_with_list</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>),</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.<span class="bu">min</span>().alias(<span class="st">'min'</span>),</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.<span class="bu">max</span>().alias(<span class="st">'max'</span>),</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.<span class="bu">sum</span>().alias(<span class="st">'sum'</span>),</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.mean().alias(<span class="st">'mean'</span>),</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.median().alias(<span class="st">'median'</span>),</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.var().alias(<span class="st">'var'</span>),</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.std().alias(<span class="st">'std'</span>),</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.n_unique().alias(<span class="st">'n_unique'</span>),</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.unique().alias(<span class="st">'unique'</span>),</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.<span class="bu">len</span>().alias(<span class="st">'len'</span>),</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-statistical-aggregations" class="cell-output cell-output-display" data-execution_count="24">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 11)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ab</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">max</th>
<th data-quarto-table-cell-role="th">sum</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">median</th>
<th data-quarto-table-cell-role="th">var</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">n_unique</th>
<th data-quarto-table-cell-role="th">unique</th>
<th data-quarto-table-cell-role="th">len</th>
</tr>
<tr class="odd">
<th>list[i64]</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>u32</th>
<th>list[i64]</th>
<th>u32</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[1, 1]</td>
<td>1</td>
<td>1</td>
<td>2</td>
<td>1.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1</td>
<td>[1]</td>
<td>2</td>
</tr>
<tr class="even">
<td>[1, 2]</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>1.5</td>
<td>1.5</td>
<td>0.5</td>
<td>0.707107</td>
<td>2</td>
<td>[1, 2]</td>
<td>2</td>
</tr>
<tr class="odd">
<td>[2, 3]</td>
<td>2</td>
<td>3</td>
<td>5</td>
<td>2.5</td>
<td>2.5</td>
<td>0.5</td>
<td>0.707107</td>
<td>2</td>
<td>[2, 3]</td>
<td>2</td>
</tr>
<tr class="even">
<td>[2, 4]</td>
<td>2</td>
<td>4</td>
<td>6</td>
<td>3.0</td>
<td>3.0</td>
<td>2.0</td>
<td>1.414214</td>
<td>2</td>
<td>[2, 4]</td>
<td>2</td>
</tr>
<tr class="odd">
<td>[3, 5]</td>
<td>3</td>
<td>5</td>
<td>8</td>
<td>4.0</td>
<td>4.0</td>
<td>2.0</td>
<td>1.414214</td>
<td>2</td>
<td>[3, 5]</td>
<td>2</td>
</tr>
<tr class="even">
<td>[3, 6]</td>
<td>3</td>
<td>6</td>
<td>9</td>
<td>4.5</td>
<td>4.5</td>
<td>4.5</td>
<td>2.12132</td>
<td>2</td>
<td>[3, 6]</td>
<td>2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="ordering-and-ranking" class="level3">
<h3 class="anchored" data-anchor-id="ordering-and-ranking">Ordering and Ranking</h3>
<p>.sort:</p>
<p>.reverse:</p>
<div id="cell-list-ordering-and-ranking" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    df_with_list</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>),</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>        <span class="co"># pl.col('ab').list.rank().alias('rank'),</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.sort().alias(<span class="st">'sort'</span>),</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.reverse().alias(<span class="st">'reverse'</span>),</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-ordering-and-ranking" class="cell-output cell-output-display" data-execution_count="25">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 3)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ab</th>
<th data-quarto-table-cell-role="th">sort</th>
<th data-quarto-table-cell-role="th">reverse</th>
</tr>
<tr class="odd">
<th>list[i64]</th>
<th>list[i64]</th>
<th>list[i64]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[1, 1]</td>
<td>[1, 1]</td>
<td>[1, 1]</td>
</tr>
<tr class="even">
<td>[1, 2]</td>
<td>[1, 2]</td>
<td>[2, 1]</td>
</tr>
<tr class="odd">
<td>[2, 3]</td>
<td>[2, 3]</td>
<td>[3, 2]</td>
</tr>
<tr class="even">
<td>[2, 4]</td>
<td>[2, 4]</td>
<td>[4, 2]</td>
</tr>
<tr class="odd">
<td>[3, 5]</td>
<td>[3, 5]</td>
<td>[5, 3]</td>
</tr>
<tr class="even">
<td>[3, 6]</td>
<td>[3, 6]</td>
<td>[6, 3]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="sequence-operations" class="level3">
<h3 class="anchored" data-anchor-id="sequence-operations">Sequence Operations</h3>
<p>.diff</p>
<div id="cell-list-diff" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    df_with_list</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>),</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.diff().alias(<span class="st">'diff'</span>),</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-diff" class="cell-output cell-output-display" data-execution_count="26">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ab</th>
<th data-quarto-table-cell-role="th">diff</th>
</tr>
<tr class="odd">
<th>list[i64]</th>
<th>list[i64]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[1, 1]</td>
<td>[null, 0]</td>
</tr>
<tr class="even">
<td>[1, 2]</td>
<td>[null, 1]</td>
</tr>
<tr class="odd">
<td>[2, 3]</td>
<td>[null, 1]</td>
</tr>
<tr class="even">
<td>[2, 4]</td>
<td>[null, 2]</td>
</tr>
<tr class="odd">
<td>[3, 5]</td>
<td>[null, 2]</td>
</tr>
<tr class="even">
<td>[3, 6]</td>
<td>[null, 3]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="logical-aggregations" class="level3">
<h3 class="anchored" data-anchor-id="logical-aggregations">Logical Aggregations</h3>
<div id="cell-list-logical-aggregations" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    df_with_list</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>),</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.<span class="bu">eval</span>(pl.element().eq(<span class="dv">1</span>)).<span class="bu">list</span>.<span class="bu">any</span>().alias(<span class="st">'any'</span>),</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.<span class="bu">eval</span>(pl.element().eq(<span class="dv">1</span>)).<span class="bu">list</span>.<span class="bu">all</span>().alias(<span class="st">'all'</span>),</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-logical-aggregations" class="cell-output cell-output-display" data-execution_count="27">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 3)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ab</th>
<th data-quarto-table-cell-role="th">any</th>
<th data-quarto-table-cell-role="th">all</th>
</tr>
<tr class="odd">
<th>list[i64]</th>
<th>bool</th>
<th>bool</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[1, 1]</td>
<td>true</td>
<td>true</td>
</tr>
<tr class="even">
<td>[1, 2]</td>
<td>true</td>
<td>false</td>
</tr>
<tr class="odd">
<td>[2, 3]</td>
<td>false</td>
<td>false</td>
</tr>
<tr class="even">
<td>[2, 4]</td>
<td>false</td>
<td>false</td>
</tr>
<tr class="odd">
<td>[3, 5]</td>
<td>false</td>
<td>false</td>
</tr>
<tr class="even">
<td>[3, 6]</td>
<td>false</td>
<td>false</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="string-operations" class="level3">
<h3 class="anchored" data-anchor-id="string-operations">String Operations</h3>
<div id="cell-list-strings" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>df_2_with_list <span class="op">=</span> pl.DataFrame(</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ab"</span>: [[<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>], [<span class="st">"d"</span>, <span class="st">"e"</span>, <span class="st">"f"</span>], [<span class="st">"g"</span>, <span class="st">"h"</span>, <span class="st">"i"</span>]],</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">'sep'</span>: [<span class="st">'@'</span>, <span class="st">'#'</span>, <span class="st">'$'</span>]</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    df_2_with_list</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>),</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.join(pl.col(<span class="st">'sep'</span>)).alias(<span class="st">'joined'</span>),</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.contains(<span class="st">'a'</span>).alias(<span class="st">'contains_a'</span>),</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.count_matches(<span class="st">'a'</span>).alias(<span class="st">'count_a'</span>),</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-strings" class="cell-output cell-output-display" data-execution_count="28">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ab</th>
<th data-quarto-table-cell-role="th">joined</th>
<th data-quarto-table-cell-role="th">contains_a</th>
<th data-quarto-table-cell-role="th">count_a</th>
</tr>
<tr class="odd">
<th>list[str]</th>
<th>str</th>
<th>bool</th>
<th>u32</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>["a", "b", "c"]</td>
<td>"a@b@c"</td>
<td>true</td>
<td>1</td>
</tr>
<tr class="even">
<td>["d", "e", "f"]</td>
<td>"d#e#f"</td>
<td>false</td>
<td>0</td>
</tr>
<tr class="odd">
<td>["g", "h", "i"]</td>
<td>"g$h$i"</td>
<td>false</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="missing" class="level3">
<h3 class="anchored" data-anchor-id="missing">Missing</h3>
<p>I believe everything can be done with <code>.list.eval(pl.element().method())</code>.</p>
</section>
<section id="set-operations" class="level3">
<h3 class="anchored" data-anchor-id="set-operations">Set Operations</h3>
<p>.list.set_intersection</p>
<p>.list.set_union</p>
<p>.list.set_difference</p>
<p>.list.set_symmetric_difference</p>
</section>
<section id="exporting-to-other-nested-dtypes" class="level3">
<h3 class="anchored" data-anchor-id="exporting-to-other-nested-dtypes">Exporting to Other Nested Dtypes</h3>
<div id="cell-list-to-struct" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    df_with_list</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>),</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.to_struct().alias(<span class="st">'ab_struct'</span>),</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.to_array(width<span class="op">=</span><span class="dv">2</span>).alias(<span class="st">'ab_array'</span>),</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-to-struct" class="cell-output cell-output-display" data-execution_count="29">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 3)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ab</th>
<th data-quarto-table-cell-role="th">ab_struct</th>
<th data-quarto-table-cell-role="th">ab_array</th>
</tr>
<tr class="odd">
<th>list[i64]</th>
<th>struct[2]</th>
<th>array[i64, 2]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[1, 1]</td>
<td>{1,1}</td>
<td>[1, 1]</td>
</tr>
<tr class="even">
<td>[1, 2]</td>
<td>{1,2}</td>
<td>[1, 2]</td>
</tr>
<tr class="odd">
<td>[2, 3]</td>
<td>{2,3}</td>
<td>[2, 3]</td>
</tr>
<tr class="even">
<td>[2, 4]</td>
<td>{2,4}</td>
<td>[2, 4]</td>
</tr>
<tr class="odd">
<td>[3, 5]</td>
<td>{3,5}</td>
<td>[3, 5]</td>
</tr>
<tr class="even">
<td>[3, 6]</td>
<td>{3,6}</td>
<td>[3, 6]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="examples" class="level3">
<h3 class="anchored" data-anchor-id="examples">Examples</h3>
<section id="ecdf" class="level4">
<h4 class="anchored" data-anchor-id="ecdf">ECDF</h4>
<div id="cell-list-ecdf" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    df_with_list</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).alias(<span class="st">'raw'</span>),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.<span class="bu">eval</span>(pl.element().rank()).alias(<span class="st">'ranks'</span>),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.<span class="bu">eval</span>(pl.element().rank().truediv(<span class="dv">2</span>)).alias(<span class="st">'ecdf_1'</span>),</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># pl.col('ab').list.eval(pl.element().rank().truediv(pl.col('ab').list.len())).alias('ecdf_2'),</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-ecdf" class="cell-output cell-output-display" data-execution_count="30">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 3)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">raw</th>
<th data-quarto-table-cell-role="th">ranks</th>
<th data-quarto-table-cell-role="th">ecdf_1</th>
</tr>
<tr class="odd">
<th>list[i64]</th>
<th>list[f64]</th>
<th>list[f64]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[1, 1]</td>
<td>[1.5, 1.5]</td>
<td>[0.75, 0.75]</td>
</tr>
<tr class="even">
<td>[1, 2]</td>
<td>[1.0, 2.0]</td>
<td>[0.5, 1.0]</td>
</tr>
<tr class="odd">
<td>[2, 3]</td>
<td>[1.0, 2.0]</td>
<td>[0.5, 1.0]</td>
</tr>
<tr class="even">
<td>[2, 4]</td>
<td>[1.0, 2.0]</td>
<td>[0.5, 1.0]</td>
</tr>
<tr class="odd">
<td>[3, 5]</td>
<td>[1.0, 2.0]</td>
<td>[0.5, 1.0]</td>
</tr>
<tr class="even">
<td>[3, 6]</td>
<td>[1.0, 2.0]</td>
<td>[0.5, 1.0]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Things to note:</p>
<ul>
<li>Currently, <code>.list.eval()</code> cannot reference another column. See <a href="https://github.com/pola-rs/polars/issues/7210">issue</a>.</li>
<li><code>.list.eval(pl.element())</code> can do more than point_wise operations. Think about the <code>rank()</code> example.</li>
<li><code>.rank()</code> has a <code>method</code> argument that can be used to specify how to deal with ties.</li>
</ul>
</section>
<section id="arg_max_horizontal" class="level4">
<h4 class="anchored" data-anchor-id="arg_max_horizontal">arg_max_horizontal</h4>
<p>Note, there currently is no <code>pl.arg_max_horizontal()</code> method. We will try to make one by concatenating columns to list, and then using the <code>.list.arg_max()</code>. In particular, we will want the arg_max col name, and not the index.</p>
<div id="cell-arg-max-horizontal" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    df</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>        pl.concat_list([pl.col(<span class="st">"a"</span>), pl.col(<span class="st">"b"</span>)]).<span class="bu">list</span>.arg_max().alias(<span class="st">'arg_max'</span>),</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'a'</span>,<span class="st">'b'</span>,</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>        (</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>            pl.col(<span class="st">'arg_max'</span>)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>            .map_elements(<span class="kw">lambda</span> i: df.columns[i], return_dtype<span class="op">=</span>pl.Utf8)</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>            .alias(<span class="st">'arg_max_col_name'</span>)</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="arg-max-horizontal" class="cell-output cell-output-display" data-execution_count="31">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 3)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">b</th>
<th data-quarto-table-cell-role="th">arg_max_col_name</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>i64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1</td>
<td>"a"</td>
</tr>
<tr class="even">
<td>1</td>
<td>2</td>
<td>"b"</td>
</tr>
<tr class="odd">
<td>2</td>
<td>3</td>
<td>"b"</td>
</tr>
<tr class="even">
<td>2</td>
<td>4</td>
<td>"b"</td>
</tr>
<tr class="odd">
<td>3</td>
<td>5</td>
<td>"b"</td>
</tr>
<tr class="even">
<td>3</td>
<td>6</td>
<td>"b"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Things to note:</p>
<ul>
<li>Can you find a more efficient way to do this? Maybe using a struct?</li>
</ul>
</section>
</section>
</section>
<section id="sec-list-explode" class="level2">
<h2 class="anchored" data-anchor-id="sec-list-explode"><code>.list.explode()</code></h2>
<p>Explode: “explode” the list onto a column.</p>
<div id="87e5b48d" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    df_with_list</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.explode().alias(<span class="st">'ab_exploded'</span>),</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (12, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ab_exploded</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>1</td>
</tr>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
</tr>
<tr class="odd">
<td>2</td>
</tr>
<tr class="even">
<td>…</td>
</tr>
<tr class="odd">
<td>4</td>
</tr>
<tr class="even">
<td>3</td>
</tr>
<tr class="odd">
<td>5</td>
</tr>
<tr class="even">
<td>3</td>
</tr>
<tr class="odd">
<td>6</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Implode: “implode” the list back into a list.</p>
<div id="b045f42c" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    df_with_list</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).implode().alias(<span class="st">'ab_imploded'</span>),</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.explode().implode().alias(<span class="st">'ab_exploded_imploded'</span>),</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ab_imploded</th>
<th data-quarto-table-cell-role="th">ab_exploded_imploded</th>
</tr>
<tr class="odd">
<th>list[list[i64]]</th>
<th>list[i64]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[[1, 1], [1, 2], … [3, 6]]</td>
<td>[1, 1, … 6]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Use group-wise to work on the list as a column.</p>
<div id="32274faf" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    df_with_list</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    .with_row_index()</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    .group_by(<span class="st">'index'</span>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.explode().alias(<span class="st">'this_is_actually_a_column'</span>),</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">index</th>
<th data-quarto-table-cell-role="th">this_is_actually_a_column</th>
</tr>
<tr class="odd">
<th>u32</th>
<th>list[i64]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>[1, 1]</td>
</tr>
<tr class="even">
<td>1</td>
<td>[1, 2]</td>
</tr>
<tr class="odd">
<td>2</td>
<td>[2, 3]</td>
</tr>
<tr class="even">
<td>3</td>
<td>[2, 4]</td>
</tr>
<tr class="odd">
<td>4</td>
<td>[3, 5]</td>
</tr>
<tr class="even">
<td>5</td>
<td>[3, 6]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>There is also <code>df.explode()</code></p>
<div id="cell-df-explode" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>df_with_list.explode(<span class="st">'ab'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="df-explode" class="cell-output cell-output-display" data-execution_count="35">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (12, 3)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">b</th>
<th data-quarto-table-cell-role="th">ab</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>i64</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td>1</td>
<td>2</td>
<td>1</td>
</tr>
<tr class="even">
<td>1</td>
<td>2</td>
<td>2</td>
</tr>
<tr class="odd">
<td>2</td>
<td>3</td>
<td>2</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>2</td>
<td>4</td>
<td>4</td>
</tr>
<tr class="even">
<td>3</td>
<td>5</td>
<td>3</td>
</tr>
<tr class="odd">
<td>3</td>
<td>5</td>
<td>5</td>
</tr>
<tr class="even">
<td>3</td>
<td>6</td>
<td>3</td>
</tr>
<tr class="odd">
<td>3</td>
<td>6</td>
<td>6</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<section id="examples-1" class="level3">
<h3 class="anchored" data-anchor-id="examples-1">Examples</h3>
<section id="quantile" class="level4">
<h4 class="anchored" data-anchor-id="quantile">Quantile</h4>
<p>Recall there is no <code>.list.quantile()</code> method; so we need to brew our own.</p>
<div id="cell-quantile-example" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>df_for_quantile <span class="op">=</span> (</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    df_with_list</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.sample(<span class="dv">100</span>, with_replacement<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>df_for_quantile.to_pandas()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="quantile-example" class="cell-output cell-output-display" data-execution_count="36">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ab</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>[1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, ...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>[2, 2, 1, 2, 1, 2, 2, 1, 1, 2, 1, 2, 2, 1, 2, ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>[2, 3, 3, 3, 3, 3, 2, 3, 2, 2, 2, 3, 3, 2, 3, ...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>[4, 2, 4, 4, 2, 2, 2, 4, 2, 2, 4, 2, 4, 2, 4, ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>[5, 3, 3, 5, 3, 3, 5, 3, 3, 3, 5, 5, 3, 3, 5, ...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>[6, 3, 6, 6, 6, 3, 3, 6, 6, 3, 6, 6, 3, 6, 6, ...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="fc1e748f" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    df_for_quantile</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    .with_row_index()</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    .group_by(<span class="st">'index'</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).explode().quantile(<span class="fl">0.2</span>)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">index</th>
<th data-quarto-table-cell-role="th">ab</th>
</tr>
<tr class="odd">
<th>u32</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td>1</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td>2</td>
<td>2.0</td>
</tr>
<tr class="even">
<td>3</td>
<td>2.0</td>
</tr>
<tr class="odd">
<td>4</td>
<td>3.0</td>
</tr>
<tr class="even">
<td>5</td>
<td>3.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Things to note:</p>
<ol type="1">
<li>The explode within row index is a powerful trick to apply any <code>pl.col()</code> method to a list.</li>
<li>There is another way to apply <code>pl.col()</code> methods to a list… With <code>.list.eval(pl.element())</code> as in the next example.</li>
</ol>
<div id="8c1d9577" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    df_for_quantile</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.<span class="bu">eval</span>(pl.element().quantile(<span class="fl">0.2</span>))</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>        .<span class="bu">list</span>.first() <span class="co"># to extract a float from a list</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>        .alias(<span class="st">'quantile_0.2'</span>),</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">quantile_0.2</th>
</tr>
<tr class="odd">
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1.0</td>
</tr>
<tr class="even">
<td>1.0</td>
</tr>
<tr class="odd">
<td>2.0</td>
</tr>
<tr class="even">
<td>2.0</td>
</tr>
<tr class="odd">
<td>3.0</td>
</tr>
<tr class="even">
<td>3.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="polars-lists-of-polars-lists" class="level2">
<h2 class="anchored" data-anchor-id="polars-lists-of-polars-lists">Polars Lists of Polars Lists</h2>
<div id="cell-list-of-list" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>df_with_list_of_list <span class="op">=</span> pl.DataFrame(</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"a"</span>: [[[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>], [<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>], [<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>]], [[<span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>], [<span class="dv">13</span>, <span class="dv">14</span>, <span class="dv">15</span>], [<span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">18</span>]]],</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"b"</span>: [<span class="st">"a"</span>, <span class="st">"b"</span>]</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>df_with_list_of_list</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-of-list" class="cell-output cell-output-display" data-execution_count="39">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">b</th>
</tr>
<tr class="odd">
<th>list[list[i64]]</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[[1, 2, 3], [4, 5, 6], [7, 8, 9]]</td>
<td>"a"</td>
</tr>
<tr class="even">
<td>[[10, 11, 12], [13, 14, 15], [16, 17, 18]]</td>
<td>"b"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>List operations will work one level deep.</p>
<div id="cell-list-of-list-inner" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    df_with_list_of_list</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'a'</span>),</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'a'</span>).<span class="bu">list</span>.get(<span class="dv">0</span>).alias(<span class="st">'get_1'</span>), </span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># pl.col('a').list.gather([0]).alias('gather_1'), # returns a list</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># pl.col('a').list.slice(0,1).alias('slice_1'), # returns a list</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># pl.col('a').list.gather([0, 1]).alias('gather_2'),</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># pl.col('a').list.slice(0,2).alias('slice_2'),</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># pl.col('a').list.gather_every(2).alias('gather_every_2'),</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-of-list-inner" class="cell-output cell-output-display" data-execution_count="40">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">get_1</th>
</tr>
<tr class="odd">
<th>list[list[i64]]</th>
<th>list[i64]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[[1, 2, 3], [4, 5, 6], [7, 8, 9]]</td>
<td>[1, 2, 3]</td>
</tr>
<tr class="even">
<td>[[10, 11, 12], [13, 14, 15], [16, 17, 18]]</td>
<td>[10, 11, 12]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="examples-2" class="level2">
<h2 class="anchored" data-anchor-id="examples-2">Examples</h2>
<section id="filter-a-list-with-a-predicte" class="level3">
<h3 class="anchored" data-anchor-id="filter-a-list-with-a-predicte">Filter A List With A Predicte</h3>
<div id="dd9cbc0f" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample data</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> {</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'string_list'</span>: [</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>        [<span class="st">"apple"</span>, <span class="st">"banana"</span>, <span class="st">"orange"</span>, <span class="st">"grape"</span>, <span class="st">"pear"</span>],</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>        [<span class="st">"apple"</span>, <span class="st">"banana"</span>, <span class="st">"orange"</span>, <span class="st">"grape"</span>],</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>        [<span class="st">"apple"</span>, <span class="st">"banana"</span>, <span class="st">"orange"</span>],</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>        [<span class="st">"apple"</span>, <span class="st">"banana"</span>],</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>        [<span class="st">"apple"</span>],</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>        [<span class="st">"apple"</span>, <span class="st">"banana"</span>, <span class="st">"orange"</span>, <span class="st">"grape"</span>, <span class="st">"pear"</span>],</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>        [<span class="st">"apple"</span>, <span class="st">"banana"</span>, <span class="st">"orange"</span>, <span class="st">"grape"</span>],</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a polars DataFrame</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pl.DataFrame(data)</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (7, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">string_list</th>
</tr>
<tr class="odd">
<th>list[str]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>["apple", "banana", … "pear"]</td>
</tr>
<tr class="even">
<td>["apple", "banana", … "grape"]</td>
</tr>
<tr class="odd">
<td>["apple", "banana", "orange"]</td>
</tr>
<tr class="even">
<td>["apple", "banana"]</td>
</tr>
<tr class="odd">
<td>["apple"]</td>
</tr>
<tr class="even">
<td>["apple", "banana", … "pear"]</td>
</tr>
<tr class="odd">
<td>["apple", "banana", … "grape"]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>In each list, keep only strings of length 4.</p>
<p>Syntax 1:</p>
<div id="ebe614cd" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>    df</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    .with_row_index(<span class="st">'i'</span>)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'string_list'</span>).<span class="bu">list</span>.gather(</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>            pl.arg_where(</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>                pl.col(<span class="st">'string_list'</span>).explode().<span class="bu">str</span>.len_chars().eq(<span class="dv">4</span>))</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>                .over(<span class="st">'i'</span>)</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>    .drop(<span class="st">'i'</span>)</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (7, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">string_list</th>
</tr>
<tr class="odd">
<th>list[str]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>["pear"]</td>
</tr>
<tr class="even">
<td>[]</td>
</tr>
<tr class="odd">
<td>[]</td>
</tr>
<tr class="even">
<td>[]</td>
</tr>
<tr class="odd">
<td>[]</td>
</tr>
<tr class="even">
<td>["pear"]</td>
</tr>
<tr class="odd">
<td>[]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Syntax 2:</p>
<div id="20b18a61" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>    df</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    .with_row_index(<span class="st">'i'</span>)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>        (</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>            (cntr<span class="op">:=</span>pl.col(<span class="st">'string_list'</span>).explode())</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>            .<span class="bu">filter</span>(cntr.<span class="bu">str</span>.len_chars().eq(<span class="dv">4</span>))</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>        .implode()</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>        .over(<span class="st">'i'</span>)</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    .drop(<span class="st">'i'</span>)</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (7, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">string_list</th>
</tr>
<tr class="odd">
<th>list[str]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>["pear"]</td>
</tr>
<tr class="even">
<td>[]</td>
</tr>
<tr class="odd">
<td>[]</td>
</tr>
<tr class="even">
<td>[]</td>
</tr>
<tr class="odd">
<td>[]</td>
</tr>
<tr class="even">
<td>["pear"]</td>
</tr>
<tr class="odd">
<td>[]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Syntax 3:</p>
<div id="dabb2d93" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>    df</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'string_list'</span>).<span class="bu">list</span>.gather(</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>            pl.col(<span class="st">'string_list'</span>).<span class="bu">list</span>.<span class="bu">eval</span>(</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>                pl.arg_where(</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>                    pl.element().<span class="bu">str</span>.len_chars().eq(<span class="dv">4</span>)</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (7, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">string_list</th>
</tr>
<tr class="odd">
<th>list[str]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>["pear"]</td>
</tr>
<tr class="even">
<td>[]</td>
</tr>
<tr class="odd">
<td>[]</td>
</tr>
<tr class="even">
<td>[]</td>
</tr>
<tr class="odd">
<td>[]</td>
</tr>
<tr class="even">
<td>["pear"]</td>
</tr>
<tr class="odd">
<td>[]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="sec-array" class="level1">
<h1>Polars Array</h1>
<p>Polars Arrays as Polars lists with a fixed length.</p>
<section id="making-a-polars-array" class="level2">
<h2 class="anchored" data-anchor-id="making-a-polars-array">Making a Polars Array</h2>
<p>Make a Polars array from a Python list.</p>
<div id="cell-make-array" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>pl.DataFrame(</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>        pl.Series(<span class="st">"Array_1"</span>, [[<span class="dv">1</span>, <span class="dv">3</span>], [<span class="dv">2</span>, <span class="dv">5</span>]]),</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>        pl.Series(<span class="st">"Array_2"</span>, [[<span class="dv">1</span>, <span class="dv">7</span>, <span class="dv">3</span>], [<span class="dv">8</span>, <span class="dv">1</span>, <span class="dv">0</span>]]),</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    schema<span class="op">=</span>{</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Array_1"</span>: pl.Array(pl.Int64, <span class="dv">2</span>),</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Array_2"</span>: pl.Array(pl.Int64, <span class="dv">3</span>),</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="make-array" class="cell-output cell-output-display" data-execution_count="45">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Array_1</th>
<th data-quarto-table-cell-role="th">Array_2</th>
</tr>
<tr class="odd">
<th>array[i64, 2]</th>
<th>array[i64, 3]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[1, 3]</td>
<td>[1, 7, 3]</td>
</tr>
<tr class="even">
<td>[2, 5]</td>
<td>[8, 1, 0]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Things to note:</p>
<ul>
<li>The dtype of the array is specified in the schema. Otherwise, a Polars list would have been inferred.</li>
</ul>
</section>
<section id="array-methods" class="level2">
<h2 class="anchored" data-anchor-id="array-methods">Array Methods</h2>
<p>Currently, list methods and array methods seem to be the same. I expect these lists to diverge in the future, because more operations can be defined when assuming a fixed length.</p>
</section>
</section>
<section id="sec-struct" class="level1">
<h1>Polars Struct</h1>
<section id="making-a-polars-struct" class="level2">
<h2 class="anchored" data-anchor-id="making-a-polars-struct">Making a Polars Struct</h2>
<p>Make a Polars struct from a Python dict.</p>
<div id="cell-make-struct" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>pl.DataFrame(</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"a"</span>: [{<span class="st">"x"</span>: <span class="dv">1</span>, <span class="st">"y"</span>: <span class="dv">2</span>}, {<span class="st">"x"</span>: <span class="dv">3</span>, <span class="st">"y"</span>: <span class="dv">4</span>}, {<span class="st">"x"</span>: <span class="dv">5</span>, <span class="st">"y"</span>: <span class="dv">6</span>}],</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"b"</span>: [<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>]</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="make-struct" class="cell-output cell-output-display" data-execution_count="46">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">b</th>
</tr>
<tr class="odd">
<th>struct[2]</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>{1,2}</td>
<td>"a"</td>
</tr>
<tr class="even">
<td>{3,4}</td>
<td>"b"</td>
</tr>
<tr class="odd">
<td>{5,6}</td>
<td>"c"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>What are the differences between a Polars struct and a Python dict?</p>
<ol type="1">
<li>The Polars stuct must have the same keys (called <code>fields</code>) in all rows.</li>
<li>A Polars struct is a first-class citizen in the Polars API, with its own methods and functions.</li>
<li>Besides these, I am still figuring it out.</li>
</ol>
<p>What are the differences between a Polars struct and a Polars list?</p>
<ol type="1">
<li>A Polars struct has named elements, while a Polars list has unnamed elements.</li>
<li>Because the struct has the same fields in all rows, it must have the same length in all rows. This is not the case for a Polars list.</li>
</ol>
<p>More often you will not make a Polars struct directly, but rather you will create one from a Polars DataFrame:</p>
<ol type="1">
<li>By directly creating a struct.</li>
<li>As the output of some operation, like <code>pl.Expr().value_counts()</code>, or all the horizontal cumulators like <code>pl.cum_sum_horizontal()</code>, <code>pl.cum_reduce()</code>, <code>pl.cum_fold()</code>, …</li>
<li>From a Polars list.</li>
</ol>
<section id="making-a-polars-struct-directly" class="level3">
<h3 class="anchored" data-anchor-id="making-a-polars-struct-directly">Making a Polars Struct Directly</h3>
<div id="make-struct-directly" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>df_with_struct <span class="op">=</span> df.select(pl.struct([<span class="st">'a'</span>,<span class="st">'b'</span>]).alias(<span class="st">'struct'</span>))</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>df_with_struct</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>ColumnNotFoundError: a

Error originated just after this operation:
DF ["string_list"]; PROJECT */1 COLUMNS; SELECTION: "None"</code></pre>
</div>
</div>
<p>Verify that the column is a struct:</p>
<div id="verify-struct" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>df_with_struct.schema</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>NameError: name 'df_with_struct' is not defined</code></pre>
</div>
</div>
<p>Alternative constructors</p>
<div id="c2d4ab24" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>df.select(pl.struct(aaa<span class="op">=</span>pl.col(<span class="st">'a'</span>), bbb<span class="op">=</span>pl.col(<span class="st">'b'</span>))).schema</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>ColumnNotFoundError: a

Error originated just after this operation:
DF ["string_list"]; PROJECT */1 COLUMNS; SELECTION: "None"</code></pre>
</div>
</div>
</section>
<section id="struct-as-output" class="level3">
<h3 class="anchored" data-anchor-id="struct-as-output">Struct As Output</h3>
<div id="58238eaf" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>df.select(pl.col(<span class="st">'a'</span>).value_counts())</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="co"># df.select(pl.col('a').value_counts()).schema</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>ColumnNotFoundError: a

Error originated just after this operation:
DF ["string_list"]; PROJECT */1 COLUMNS; SELECTION: "None"</code></pre>
</div>
</div>
</section>
<section id="struct-from-list" class="level3">
<h3 class="anchored" data-anchor-id="struct-from-list">Struct From List</h3>
<div id="cell-struct-from-list" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>df_with_list.select(pl.col(<span class="st">'ab'</span>).<span class="bu">list</span>.to_struct())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="struct-from-list" class="cell-output cell-output-display" data-execution_count="51">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ab</th>
</tr>
<tr class="odd">
<th>struct[2]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>{1,1}</td>
</tr>
<tr class="even">
<td>{1,2}</td>
</tr>
<tr class="odd">
<td>{2,3}</td>
</tr>
<tr class="even">
<td>{2,4}</td>
</tr>
<tr class="odd">
<td>{3,5}</td>
</tr>
<tr class="even">
<td>{3,6}</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="struct-methods" class="level2">
<h2 class="anchored" data-anchor-id="struct-methods">Struct Methods</h2>
<section id="extracting-elements" class="level3">
<h3 class="anchored" data-anchor-id="extracting-elements">Extracting Elements</h3>
<div id="struct-get" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>    df_with_struct</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'struct'</span>).struct.field(<span class="st">'a'</span>),</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'struct'</span>).struct.field(<span class="st">'b'</span>),</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>NameError: name 'df_with_struct' is not defined</code></pre>
</div>
</div>
<p>To text in JSON format:</p>
<div id="struct-to-json" class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>    df_with_struct</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'struct'</span>).struct.json_encode()</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>NameError: name 'df_with_struct' is not defined</code></pre>
</div>
</div>
</section>
</section>
<section id="struct-to-list" class="level2">
<h2 class="anchored" data-anchor-id="struct-to-list">Struct to List</h2>
<p>There is no <code>.struct.to_list()</code> method. This makes sense, since a struct does not require all fields to have the same dtype. In the case where all fields have the same dtype, you can use the following.</p>
<div id="struct-to-list" class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>    df_with_struct</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>    .unnest(<span class="st">'struct'</span>)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>    .select(pl.concat_list(pl.<span class="bu">all</span>()))</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>NameError: name 'df_with_struct' is not defined</code></pre>
</div>
</div>
<p>You can also consider element-by-element extractions.</p>
<div id="struct-to-list-element-by-element" class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>    df_with_struct</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>        pl.concat_list([</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>            pl.col(<span class="st">'struct'</span>).struct.field(<span class="st">'a'</span>), </span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>            pl.col(<span class="st">'struct'</span>).struct.field(<span class="st">'b'</span>)</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>            ])</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>NameError: name 'df_with_struct' is not defined</code></pre>
</div>
</div>
</section>
</section>
<section id="discussion" class="level1">
<h1>Discussion</h1>
<section id="general" class="level2">
<h2 class="anchored" data-anchor-id="general">General</h2>
<p>Q: Can I have a list of list of lists (i.e.&nbsp;more than 2 layers of nesting)?<br>
A: No.&nbsp;Only a list within a list.</p>
<p>Q: Can I use list methods on a struct?(e.g.&nbsp;argmax)<br>
A: No.&nbsp;But you can extract the struct to a list, and then use list methods.</p>
<p>Q: When a Polars Array and when a set of columns? A: I am still thinking about it.</p>
</section>
<section id="exporting" class="level2">
<h2 class="anchored" data-anchor-id="exporting">Exporting</h2>
<p>Can I export to CSV? To Parquet?</p>
<div id="a7d8edcf" class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get tmp file name from operating system</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tempfile</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>temp_file <span class="op">=</span> os.path.join(tempfile._get_default_tempdir(), <span class="st">'something.csv'</span>)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>df_with_list.write_csv(<span class="st">'df_with_list.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>ComputeError: CSV format does not support nested data</code></pre>
</div>
</div>
<p>What is the dtype when I export to Pandas?</p>
<div id="export-to-pandas" class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>df_with_list_pandas <span class="op">=</span> df_with_list.to_pandas()</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>df_with_list_pandas.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 6 entries, 0 to 5
Data columns (total 3 columns):
 #   Column  Non-Null Count  Dtype 
---  ------  --------------  ----- 
 0   a       6 non-null      int64 
 1   b       6 non-null      int64 
 2   ab      6 non-null      object
dtypes: int64(2), object(1)
memory usage: 272.0+ bytes</code></pre>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>